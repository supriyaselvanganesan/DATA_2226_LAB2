[0m20:34:36.607424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a10050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048679d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104867c50>]}


============================== 20:34:36.610174 | bbb13004-e90b-402f-a728-95062e114072 ==============================
[0m20:34:36.610174 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m20:34:36.610414 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/Users/supriya/.dbt', 'quiet': 'False', 'empty': 'None', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'partial_parse': 'True', 'invocation_command': 'dbt deps', 'fail_fast': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default'}
[0m20:34:36.663382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbb13004-e90b-402f-a728-95062e114072', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bd4770>]}
[0m20:34:36.674415 [debug] [MainThread]: Set downloads directory='/var/folders/ps/xx6wdq2d23d7x2g81mvgc7jw0000gn/T/dbt-downloads-_6j4jvsc'
[0m20:34:36.674696 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m20:34:37.141631 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m20:34:37.144028 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m20:34:37.234794 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m20:34:37.244934 [info ] [MainThread]: Updating lock file in file path: /Users/supriya/azm_meta_stock_analytics/package-lock.yml
[0m20:34:37.245842 [debug] [MainThread]: Set downloads directory='/var/folders/ps/xx6wdq2d23d7x2g81mvgc7jw0000gn/T/dbt-downloads-en_y1eas'
[0m20:34:37.246953 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m20:34:37.606503 [info ] [MainThread]: Installed from version 1.3.1
[0m20:34:37.606734 [info ] [MainThread]: Updated version available: 1.3.2
[0m20:34:37.606897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'bbb13004-e90b-402f-a728-95062e114072', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047078a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a6e470>]}
[0m20:34:37.607073 [info ] [MainThread]: 
[0m20:34:37.607196 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m20:34:37.609223 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.036001, "process_in_blocks": "0", "process_kernel_time": 0.145372, "process_mem_max_rss": "118964224", "process_out_blocks": "0", "process_user_time": 0.587715}
[0m20:34:37.609473 [debug] [MainThread]: Command `dbt deps` succeeded at 20:34:37.609430 after 1.04 seconds
[0m20:34:37.609612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a81b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046eb890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10404b6b0>]}
[0m20:34:37.609736 [debug] [MainThread]: Flushing usage events
[0m20:34:38.018020 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:35:18.246226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e1c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061739d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106173c50>]}


============================== 13:35:18.248811 | 77728a40-45e4-408d-8559-d8ded3a05197 ==============================
[0m13:35:18.248811 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m13:35:18.249054 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'printer_width': '80', 'empty': 'False', 'cache_selected_only': 'False', 'quiet': 'False', 'target_path': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'introspect': 'True', 'debug': 'False', 'write_json': 'True', 'warn_error': 'None', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/supriya/.dbt', 'version_check': 'True'}
[0m13:35:19.440097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fe0770>]}
[0m13:35:19.463039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11640ee00>]}
[0m13:35:19.463719 [info ] [MainThread]: Registered adapter: snowflake=1.10.2
[0m13:35:19.539471 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m13:35:19.539889 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:35:19.540026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1163f2d50>]}
[0m13:35:19.989414 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `dbt_utils.unique_combination_of_columns`
defined on 'stg_stock_price' in package 'azm_meta_stock_analytics'
(models/schema.yml). Arguments to generic tests should be nested under the
`arguments` property.
[0m13:35:19.989656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1169ca210>]}
[0m13:35:20.066713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116cd8210>]}
[0m13:35:20.098660 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m13:35:20.099614 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m13:35:20.110171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116a9b860>]}
[0m13:35:20.110342 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 608 macros
[0m13:35:20.110461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116f19910>]}
[0m13:35:20.111182 [info ] [MainThread]: 
[0m13:35:20.111305 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:35:20.111392 [info ] [MainThread]: 
[0m13:35:20.111561 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:35:20.113058 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m13:35:20.144502 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m13:35:20.144637 [debug] [ThreadPool]: On list_USER_DB_KOALA: show terse schemas in database USER_DB_KOALA
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
[0m13:35:20.144727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:35:23.177083 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 3.032 seconds
[0m13:35:23.181420 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m13:35:23.193066 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m13:35:23.193343 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: show objects in USER_DB_KOALA.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */;
[0m13:35:23.352871 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.159 seconds
[0m13:35:23.357498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117eca0a0>]}
[0m13:35:23.361454 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m13:35:23.361981 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m13:35:23.362397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m13:35:23.362659 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m13:35:23.367693 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:35:23.368510 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m13:35:23.387500 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:35:23.388504 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:35:23.388690 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
  
  
  
  as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */;
[0m13:35:23.648244 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.259 seconds
[0m13:35:23.670701 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f54410>]}
[0m13:35:23.671197 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.31s]
[0m13:35:23.671547 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m13:35:23.672094 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m13:35:23.672440 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m13:35:23.672774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m13:35:23.673002 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m13:35:23.675537 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m13:35:23.675977 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m13:35:23.677383 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m13:35:23.678497 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m13:35:23.678713 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
  
  
  
  as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

rsi_calc as (
  -- RSI(14): rolling average of gains/losses
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,

    case
      when lag(close) over (partition by symbol order by date) is null then null
      else 100 - 100 / (
        1 + (
          nullif(
            avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
            over (partition by symbol order by date rows between 14 preceding and 1 preceding),
          0)
          /
          nullif(
            avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
            over (partition by symbol order by date rows between 14 preceding and 1 preceding),
          0)
        )
      )
    end as rsi_14
  from feat
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from rsi_calc
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */;
[0m13:35:23.806098 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c091cf-0307-1b2e-000f-c0df008b0622
[0m13:35:23.806497 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 90 at position 180 unexpected ';'.
[0m13:35:23.812054 [debug] [Thread-1 (]: Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  001003 (42000): SQL compilation error:
  syntax error line 90 at position 180 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:35:23.812447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77728a40-45e4-408d-8559-d8ded3a05197', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117fd5650>]}
[0m13:35:23.812944 [error] [Thread-1 (]: 2 of 3 ERROR creating sql view model analytics.stock_transformations ........... [[31mERROR[0m in 0.14s]
[0m13:35:23.813354 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m13:35:23.813741 [debug] [Thread-4 (]: Marking all children of 'model.azm_meta_stock_analytics.stock_transformations' to be skipped because of status 'error'.  Reason: Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  001003 (42000): SQL compilation error:
  syntax error line 90 at position 180 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql.
[0m13:35:23.814651 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m13:35:23.814932 [info ] [Thread-1 (]: 3 of 3 SKIP relation analytics.stock_price_technical_indicators ................ [[33mSKIP[0m]
[0m13:35:23.815174 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m13:35:23.815903 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:35:23.816145 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_transformations' was left open.
[0m13:35:23.816352 [debug] [MainThread]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m13:35:23.929974 [info ] [MainThread]: 
[0m13:35:23.931053 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 3.82 seconds (3.82s).
[0m13:35:23.932276 [debug] [MainThread]: Command end result
[0m13:35:23.956150 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m13:35:23.957213 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m13:35:23.960699 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/supriya/azm_meta_stock_analytics/target/run_results.json
[0m13:35:23.960857 [info ] [MainThread]: 
[0m13:35:23.961026 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:35:23.961162 [info ] [MainThread]: 
[0m13:35:23.961332 [error] [MainThread]: [31mFailure in model stock_transformations (models/intermediate/stock_transformations.sql)[0m
[0m13:35:23.961493 [error] [MainThread]:   Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  001003 (42000): SQL compilation error:
  syntax error line 90 at position 180 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:35:23.961613 [info ] [MainThread]: 
[0m13:35:23.961766 [info ] [MainThread]:   compiled code at target/compiled/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:35:23.961884 [info ] [MainThread]: 
[0m13:35:23.962024 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=3
[0m13:35:23.962297 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m13:35:23.965170 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.748377, "process_in_blocks": "0", "process_kernel_time": 0.351909, "process_mem_max_rss": "230981632", "process_out_blocks": "0", "process_user_time": 1.693761}
[0m13:35:23.965407 [debug] [MainThread]: Command `dbt run` failed at 13:35:23.965360 after 5.75 seconds
[0m13:35:23.965584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106204670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100652cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117a63110>]}
[0m13:35:23.965738 [debug] [MainThread]: Flushing usage events
[0m13:35:24.392056 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:38:49.210855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093dc050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7739d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a773c50>]}


============================== 13:38:49.213169 | a76fb820-5aea-4eb6-9612-a7b4c35978c8 ==============================
[0m13:38:49.213169 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m13:38:49.213397 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'printer_width': '80', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'empty': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'introspect': 'True', 'target_path': 'None', 'warn_error': 'None', 'log_format': 'default', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'profiles_dir': '/Users/supriya/.dbt', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None'}
[0m13:38:49.667516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e0770>]}
[0m13:38:49.687240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f50ee00>]}
[0m13:38:49.687715 [info ] [MainThread]: Registered adapter: snowflake=1.10.2
[0m13:38:49.738499 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m13:38:49.798339 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:38:49.798624 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/intermediate/stock_transformations.sql
[0m13:38:49.949562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa9ae50>]}
[0m13:38:49.984966 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m13:38:49.986505 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m13:38:49.998277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f6635c0>]}
[0m13:38:49.998536 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 608 macros
[0m13:38:49.998667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc957f0>]}
[0m13:38:49.999496 [info ] [MainThread]: 
[0m13:38:49.999675 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:38:49.999803 [info ] [MainThread]: 
[0m13:38:50.000028 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:38:50.001955 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m13:38:50.025838 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m13:38:50.026034 [debug] [ThreadPool]: On list_USER_DB_KOALA: show terse schemas in database USER_DB_KOALA
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
[0m13:38:50.026145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:52.654053 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.628 seconds
[0m13:38:52.660055 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m13:38:52.675477 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m13:38:52.675871 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: show objects in USER_DB_KOALA.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */;
[0m13:38:52.797851 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.121 seconds
[0m13:38:52.806566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c0a7ee0>]}
[0m13:38:52.812827 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m13:38:52.813746 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m13:38:52.814447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m13:38:52.814936 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m13:38:52.825276 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:38:52.826301 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m13:38:52.848490 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:38:52.849396 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m13:38:52.849705 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
  
  
  
  as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */;
[0m13:38:53.331867 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.481 seconds
[0m13:38:53.363911 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c06b110>]}
[0m13:38:53.364225 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.55s]
[0m13:38:53.364438 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m13:38:53.364698 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m13:38:53.364912 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m13:38:53.365108 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m13:38:53.365209 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m13:38:53.366568 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m13:38:53.366819 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m13:38:53.367738 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m13:38:53.368576 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m13:38:53.368735 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
  
  
  
  as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

rsi_calc as (
  -- RSI(14): rolling average of gains/losses
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,

    case
      when lag(close) over (partition by symbol order by date) is null then null
      else 100 - 100 / (
        1 + (
          nullif(
            avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
            over (partition by symbol order by date rows between 14 preceding and 1 preceding),
          0)
          /
          nullif(
            avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
            over (partition by symbol order by date rows between 14 preceding and 1 preceding),
          0)
        )
      )
    end as rsi_14
  from feat
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from rsi_calc















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */;
[0m13:38:53.646124 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c091d2-0307-1b2e-000f-c0df008b063a
[0m13:38:53.646905 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002062 (42601): SQL compilation error:
Window function [LAG(FEAT.CLOSE) OVER (PARTITION BY FEAT.SYMBOL ORDER BY FEAT.DATE ASC NULLS LAST)] may not be nested inside another window function.
[0m13:38:53.656030 [debug] [Thread-1 (]: Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  002062 (42601): SQL compilation error:
  Window function [LAG(FEAT.CLOSE) OVER (PARTITION BY FEAT.SYMBOL ORDER BY FEAT.DATE ASC NULLS LAST)] may not be nested inside another window function.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:38:53.656880 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a76fb820-5aea-4eb6-9612-a7b4c35978c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c219440>]}
[0m13:38:53.657691 [error] [Thread-1 (]: 2 of 3 ERROR creating sql view model analytics.stock_transformations ........... [[31mERROR[0m in 0.29s]
[0m13:38:53.658268 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m13:38:53.658823 [debug] [Thread-4 (]: Marking all children of 'model.azm_meta_stock_analytics.stock_transformations' to be skipped because of status 'error'.  Reason: Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  002062 (42601): SQL compilation error:
  Window function [LAG(FEAT.CLOSE) OVER (PARTITION BY FEAT.SYMBOL ORDER BY FEAT.DATE ASC NULLS LAST)] may not be nested inside another window function.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql.
[0m13:38:53.660292 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m13:38:53.660807 [info ] [Thread-1 (]: 3 of 3 SKIP relation analytics.stock_price_technical_indicators ................ [[33mSKIP[0m]
[0m13:38:53.661170 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m13:38:53.662256 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:38:53.662578 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_transformations' was left open.
[0m13:38:53.662795 [debug] [MainThread]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m13:38:53.778941 [info ] [MainThread]: 
[0m13:38:53.779640 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 3.78 seconds (3.78s).
[0m13:38:53.780609 [debug] [MainThread]: Command end result
[0m13:38:53.816027 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m13:38:53.818145 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m13:38:53.822419 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/supriya/azm_meta_stock_analytics/target/run_results.json
[0m13:38:53.822628 [info ] [MainThread]: 
[0m13:38:53.822850 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:38:53.823028 [info ] [MainThread]: 
[0m13:38:53.823250 [error] [MainThread]: [31mFailure in model stock_transformations (models/intermediate/stock_transformations.sql)[0m
[0m13:38:53.823467 [error] [MainThread]:   Database Error in model stock_transformations (models/intermediate/stock_transformations.sql)
  002062 (42601): SQL compilation error:
  Window function [LAG(FEAT.CLOSE) OVER (PARTITION BY FEAT.SYMBOL ORDER BY FEAT.DATE ASC NULLS LAST)] may not be nested inside another window function.
  compiled code at target/run/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:38:53.823628 [info ] [MainThread]: 
[0m13:38:53.823807 [info ] [MainThread]:   compiled code at target/compiled/azm_meta_stock_analytics/models/intermediate/stock_transformations.sql
[0m13:38:53.823963 [info ] [MainThread]: 
[0m13:38:53.824142 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=3
[0m13:38:53.827481 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.643964, "process_in_blocks": "0", "process_kernel_time": 0.292059, "process_mem_max_rss": "226131968", "process_out_blocks": "0", "process_user_time": 1.31057}
[0m13:38:53.827742 [debug] [MainThread]: Command `dbt run` failed at 13:38:53.827689 after 4.64 seconds
[0m13:38:53.827949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1a4870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c2d51c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10faba0d0>]}
[0m13:38:53.828134 [debug] [MainThread]: Flushing usage events
[0m13:38:54.290913 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:21:18.678739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10511c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064739d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106473c50>]}


============================== 14:21:18.681233 | 733acac8-2d1a-46e1-9051-7db2a3033469 ==============================
[0m14:21:18.681233 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m14:21:18.681487 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'introspect': 'True', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'static_parser': 'True', 'no_print': 'None', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'use_colors': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/supriya/.dbt', 'log_cache_events': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m14:21:19.152022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053e0770>]}
[0m14:21:19.171851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11290ee00>]}
[0m14:21:19.172324 [info ] [MainThread]: Registered adapter: snowflake=1.10.2
[0m14:21:19.224517 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m14:21:19.284904 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:21:19.285240 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/intermediate/stock_transformations.sql
[0m14:21:19.422593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11319ab50>]}
[0m14:21:19.454108 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:21:19.455166 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:21:19.465045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c635c0>]}
[0m14:21:19.465212 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 608 macros
[0m14:21:19.465334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133951d0>]}
[0m14:21:19.466016 [info ] [MainThread]: 
[0m14:21:19.466139 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:21:19.466226 [info ] [MainThread]: 
[0m14:21:19.466392 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:21:19.467879 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m14:21:19.489112 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m14:21:19.489232 [debug] [ThreadPool]: On list_USER_DB_KOALA: show terse schemas in database USER_DB_KOALA
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
[0m14:21:19.489318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:21:22.500710 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 3.011 seconds
[0m14:21:22.504832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m14:21:22.516918 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m14:21:22.517316 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: show objects in USER_DB_KOALA.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */;
[0m14:21:22.885999 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.368 seconds
[0m14:21:22.891744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117fabee0>]}
[0m14:21:22.895583 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:21:22.896089 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m14:21:22.896490 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m14:21:22.896749 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m14:21:22.902942 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:21:22.903783 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m14:21:22.921848 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:21:22.922547 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:21:22.922734 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
  
  
  
  as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */;
[0m14:21:23.191900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.269 seconds
[0m14:21:23.215255 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117f6b110>]}
[0m14:21:23.215730 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.32s]
[0m14:21:23.216079 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:21:23.216586 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m14:21:23.216935 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m14:21:23.217327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m14:21:23.217547 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m14:21:23.219957 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:21:23.220406 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m14:21:23.221826 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:21:23.223380 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m14:21:23.223652 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
  
  
  
  as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */;
[0m14:21:23.602153 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.378 seconds
[0m14:21:23.605382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115ab43c0>]}
[0m14:21:23.606043 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.39s]
[0m14:21:23.606548 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m14:21:23.607272 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:21:23.607706 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m14:21:23.608221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m14:21:23.608768 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:21:23.611031 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:21:23.611551 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:21:23.628189 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:21:23.629093 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:21:23.629324 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
    
    
    
    as (select
  symbol,
  date,
  open,
  high,
  low,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */;
[0m14:21:23.812346 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c091fd-0307-1b87-000f-c0df008b670e
[0m14:21:23.812955 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 47 at position 191 unexpected ';'.
[0m14:21:23.819323 [debug] [Thread-1 (]: Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 191 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:21:23.819909 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '733acac8-2d1a-46e1-9051-7db2a3033469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064f4b90>]}
[0m14:21:23.820491 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model analytics.stock_price_technical_indicators  [[31mERROR[0m in 0.21s]
[0m14:21:23.820930 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:21:23.821378 [debug] [Thread-4 (]: Marking all children of 'model.azm_meta_stock_analytics.stock_price_technical_indicators' to be skipped because of status 'error'.  Reason: Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 191 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql.
[0m14:21:23.823025 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:21:23.823266 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was left open.
[0m14:21:23.823470 [debug] [MainThread]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m14:21:23.940636 [info ] [MainThread]: 
[0m14:21:23.941203 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 4.47 seconds (4.47s).
[0m14:21:23.942137 [debug] [MainThread]: Command end result
[0m14:21:23.964998 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:21:23.966197 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:21:23.969626 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/supriya/azm_meta_stock_analytics/target/run_results.json
[0m14:21:23.969802 [info ] [MainThread]: 
[0m14:21:23.969987 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:21:23.970129 [info ] [MainThread]: 
[0m14:21:23.970319 [error] [MainThread]: [31mFailure in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)[0m
[0m14:21:23.970492 [error] [MainThread]:   Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 191 unexpected ';'.
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:21:23.970627 [info ] [MainThread]: 
[0m14:21:23.970776 [info ] [MainThread]:   compiled code at target/compiled/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:21:23.970902 [info ] [MainThread]: 
[0m14:21:23.971053 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m14:21:23.973777 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.3238583, "process_in_blocks": "0", "process_kernel_time": 0.26778, "process_mem_max_rss": "220479488", "process_out_blocks": "0", "process_user_time": 1.221602}
[0m14:21:23.974094 [debug] [MainThread]: Command `dbt run` failed at 14:21:23.974036 after 5.32 seconds
[0m14:21:23.974298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200ed450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11349f350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106604670>]}
[0m14:21:23.974481 [debug] [MainThread]: Flushing usage events
[0m14:21:24.415595 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:22:16.803314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081d4050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902bc50>]}


============================== 14:22:16.805659 | b3764079-f8dd-4a88-832c-a4418b0261fc ==============================
[0m14:22:16.805659 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m14:22:16.805907 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'version_check': 'True', 'printer_width': '80', 'profiles_dir': '/Users/supriya/.dbt', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'fail_fast': 'False', 'quiet': 'False', 'use_colors': 'True', 'target_path': 'None', 'write_json': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error': 'None', 'no_print': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'introspect': 'True', 'use_experimental_parser': 'False'}
[0m14:22:17.107881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108398770>]}
[0m14:22:17.127895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d02ae00>]}
[0m14:22:17.128164 [info ] [MainThread]: Registered adapter: snowflake=1.10.2
[0m14:22:17.172981 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m14:22:17.217769 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:22:17.218021 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/output/stock_price_technical_indicators.sql
[0m14:22:17.357750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d533350>]}
[0m14:22:17.392353 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:22:17.393363 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:22:17.399307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1ff5c0>]}
[0m14:22:17.399519 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 608 macros
[0m14:22:17.399648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d729390>]}
[0m14:22:17.400572 [info ] [MainThread]: 
[0m14:22:17.400729 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:22:17.400833 [info ] [MainThread]: 
[0m14:22:17.401044 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:22:17.402875 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m14:22:17.423214 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m14:22:17.423364 [debug] [ThreadPool]: On list_USER_DB_KOALA: show terse schemas in database USER_DB_KOALA
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
[0m14:22:17.423453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:22:19.978688 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.555 seconds
[0m14:22:19.982711 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m14:22:19.994602 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m14:22:19.994912 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: show objects in USER_DB_KOALA.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */;
[0m14:22:20.231481 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.236 seconds
[0m14:22:20.236858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e547ee0>]}
[0m14:22:20.240112 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:22:20.240825 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m14:22:20.241340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m14:22:20.241658 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m14:22:20.248357 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:22:20.248995 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m14:22:20.267448 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:22:20.268174 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:22:20.268358 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
  
  
  
  as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */;
[0m14:22:20.536943 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.268 seconds
[0m14:22:20.560865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e503e90>]}
[0m14:22:20.561368 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.32s]
[0m14:22:20.561721 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:22:20.562268 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m14:22:20.562628 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m14:22:20.562965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m14:22:20.563187 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m14:22:20.565673 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:22:20.566117 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m14:22:20.567513 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:22:20.569072 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m14:22:20.569349 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
  
  
  
  as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */;
[0m14:22:20.843058 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.273 seconds
[0m14:22:20.846499 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dc54050>]}
[0m14:22:20.846948 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.28s]
[0m14:22:20.847381 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m14:22:20.847862 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:22:20.848218 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m14:22:20.848638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m14:22:20.848918 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:22:20.850788 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:22:20.851242 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:22:20.865740 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:22:20.866520 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:22:20.866734 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
    
    
    
    as (select
  symbol,
  date,
  open,
  high,
  low,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */;
[0m14:22:21.077097 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c091fe-0307-1b85-000f-c0df008b38b6
[0m14:22:21.078032 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 8 at position 2
invalid identifier 'OPEN'
[0m14:22:21.083160 [debug] [Thread-1 (]: Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  000904 (42000): SQL compilation error: error line 8 at position 2
  invalid identifier 'OPEN'
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:22:21.083554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3764079-f8dd-4a88-832c-a4418b0261fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090b0b90>]}
[0m14:22:21.084057 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model analytics.stock_price_technical_indicators  [[31mERROR[0m in 0.23s]
[0m14:22:21.084452 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:22:21.084854 [debug] [Thread-4 (]: Marking all children of 'model.azm_meta_stock_analytics.stock_price_technical_indicators' to be skipped because of status 'error'.  Reason: Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  000904 (42000): SQL compilation error: error line 8 at position 2
  invalid identifier 'OPEN'
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql.
[0m14:22:21.086468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:22:21.086740 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was left open.
[0m14:22:21.086948 [debug] [MainThread]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m14:22:21.346315 [info ] [MainThread]: 
[0m14:22:21.347238 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 3.95 seconds (3.95s).
[0m14:22:21.348721 [debug] [MainThread]: Command end result
[0m14:22:21.370648 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:22:21.371643 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:22:21.375013 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/supriya/azm_meta_stock_analytics/target/run_results.json
[0m14:22:21.375178 [info ] [MainThread]: 
[0m14:22:21.375353 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:22:21.375492 [info ] [MainThread]: 
[0m14:22:21.375667 [error] [MainThread]: [31mFailure in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)[0m
[0m14:22:21.375837 [error] [MainThread]:   Database Error in model stock_price_technical_indicators (models/output/stock_price_technical_indicators.sql)
  000904 (42000): SQL compilation error: error line 8 at position 2
  invalid identifier 'OPEN'
  compiled code at target/run/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:22:21.375963 [info ] [MainThread]: 
[0m14:22:21.376109 [info ] [MainThread]:   compiled code at target/compiled/azm_meta_stock_analytics/models/output/stock_price_technical_indicators.sql
[0m14:22:21.376227 [info ] [MainThread]: 
[0m14:22:21.376372 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m14:22:21.378524 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.6015854, "process_in_blocks": "0", "process_kernel_time": 0.228685, "process_mem_max_rss": "221544448", "process_out_blocks": "0", "process_user_time": 1.252553}
[0m14:22:21.378739 [debug] [MainThread]: Command `dbt run` failed at 14:22:21.378695 after 4.60 seconds
[0m14:22:21.378904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8090d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e6895d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c8670>]}
[0m14:22:21.379057 [debug] [MainThread]: Flushing usage events
[0m14:22:21.737524 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:24:05.321514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10661c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079739d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107973c50>]}


============================== 14:24:05.323769 | 3d7dd5ea-9b19-44b5-8a20-d5fe6936c436 ==============================
[0m14:24:05.323769 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m14:24:05.324009 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/supriya/.dbt', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'quiet': 'False', 'empty': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'debug': 'False', 'printer_width': '80', 'log_path': '/Users/supriya/azm_meta_stock_analytics/logs', 'log_format': 'default', 'target_path': 'None', 'use_colors': 'True', 'partial_parse': 'True', 'introspect': 'True', 'version_check': 'True'}
[0m14:24:05.622980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068e0770>]}
[0m14:24:05.642860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e20ee00>]}
[0m14:24:05.643126 [info ] [MainThread]: Registered adapter: snowflake=1.10.2
[0m14:24:05.688939 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m14:24:05.733543 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:24:05.733795 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/output/stock_price_technical_indicators.sql
[0m14:24:05.866122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e69ef50>]}
[0m14:24:05.897250 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:24:05.897995 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:24:05.903044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e3675c0>]}
[0m14:24:05.903204 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 608 macros
[0m14:24:05.903316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e990f30>]}
[0m14:24:05.903991 [info ] [MainThread]: 
[0m14:24:05.904111 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:24:05.904200 [info ] [MainThread]: 
[0m14:24:05.904361 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:24:05.905874 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m14:24:05.924081 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m14:24:05.924213 [debug] [ThreadPool]: On list_USER_DB_KOALA: show terse schemas in database USER_DB_KOALA
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
[0m14:24:05.924304 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:08.506795 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.582 seconds
[0m14:24:08.511640 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m14:24:08.523430 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m14:24:08.523728 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: show objects in USER_DB_KOALA.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */;
[0m14:24:08.692597 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.168 seconds
[0m14:24:08.698041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119babee0>]}
[0m14:24:08.702572 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:24:08.703152 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m14:24:08.703531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m14:24:08.703791 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m14:24:08.710107 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:24:08.710638 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m14:24:08.728400 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:24:08.729224 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m14:24:08.729416 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
  
  
  
  as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */;
[0m14:24:09.182606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.453 seconds
[0m14:24:09.206114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119b6fe90>]}
[0m14:24:09.206638 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.50s]
[0m14:24:09.206996 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m14:24:09.207704 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m14:24:09.208110 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m14:24:09.208409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m14:24:09.208622 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m14:24:09.211156 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:24:09.211663 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m14:24:09.213114 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m14:24:09.214682 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m14:24:09.214968 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
  
  
  
  as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  )
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */;
[0m14:24:09.593578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.378 seconds
[0m14:24:09.597863 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10efd0100>]}
[0m14:24:09.598699 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.39s]
[0m14:24:09.599229 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m14:24:09.599876 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:24:09.600256 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m14:24:09.600572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m14:24:09.600812 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:24:09.603308 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:24:09.603997 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:24:09.619769 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:24:09.620671 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m14:24:09.620888 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
    
    
    
    as (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */;
[0m14:24:11.435811 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.814 seconds
[0m14:24:11.438965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d7dd5ea-9b19-44b5-8a20-d5fe6936c436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119db3d90>]}
[0m14:24:11.439577 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.84s]
[0m14:24:11.440039 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m14:24:11.441121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:11.441361 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was left open.
[0m14:24:11.441568 [debug] [MainThread]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m14:24:11.605423 [info ] [MainThread]: 
[0m14:24:11.606020 [info ] [MainThread]: Finished running 1 table model, 2 view models in 0 hours 0 minutes and 5.70 seconds (5.70s).
[0m14:24:11.607043 [debug] [MainThread]: Command end result
[0m14:24:11.620076 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/supriya/azm_meta_stock_analytics/target/manifest.json
[0m14:24:11.620945 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/supriya/azm_meta_stock_analytics/target/semantic_manifest.json
[0m14:24:11.623203 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/supriya/azm_meta_stock_analytics/target/run_results.json
[0m14:24:11.623320 [info ] [MainThread]: 
[0m14:24:11.623456 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:24:11.623552 [info ] [MainThread]: 
[0m14:24:11.623670 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m14:24:11.625659 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.3302836, "process_in_blocks": "0", "process_kernel_time": 0.222658, "process_mem_max_rss": "220086272", "process_out_blocks": "0", "process_user_time": 1.196134}
[0m14:24:11.625855 [debug] [MainThread]: Command `dbt run` succeeded at 14:24:11.625819 after 6.33 seconds
[0m14:24:11.625989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ea75050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119d67bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a10670>]}
[0m14:24:11.626109 [debug] [MainThread]: Flushing usage events
[0m14:24:12.155614 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:29:10.546930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff964ca600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff964ca240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff966ed970>]}


============================== 02:29:10.549887 | 97b98859-1aef-423c-810b-0f98703fb7b7 ==============================
[0m02:29:10.549887 [info ] [MainThread]: Running with dbt=1.8.7
[0m02:29:10.550317 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:29:10.553277 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m02:29:10.553805 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.044856332, "process_user_time": 0.727875, "process_kernel_time": 0.046927, "process_mem_max_rss": "167760", "process_in_blocks": "2088", "process_out_blocks": "19", "command_success": false}
[0m02:29:10.554008 [debug] [MainThread]: Command `dbt run` failed at 02:29:10.553969 after 0.05 seconds
[0m02:29:10.554138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff961051f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95a4a540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff958131d0>]}
[0m02:29:10.554274 [debug] [MainThread]: Flushing usage events
[0m02:35:00.953241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98e2aba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff962e2270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff962e2c60>]}


============================== 02:35:00.956850 | 4f6923f6-9961-4668-af0a-2eab5557f0fc ==============================
[0m02:35:00.956850 [info ] [MainThread]: Running with dbt=1.8.7
[0m02:35:00.957271 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:35:00.959178 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m02:35:00.959905 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.039543375, "process_user_time": 0.732606, "process_kernel_time": 0.050833, "process_mem_max_rss": "167748", "process_in_blocks": "46248", "process_out_blocks": "2", "command_success": false}
[0m02:35:00.960152 [debug] [MainThread]: Command `dbt run` failed at 02:35:00.960091 after 0.04 seconds
[0m02:35:00.960327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96128f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff963db2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff962b7800>]}
[0m02:35:00.960483 [debug] [MainThread]: Flushing usage events
[0m02:41:28.191036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89105ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8842b1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88429ac0>]}


============================== 02:41:28.193872 | e1e52f9b-3e46-4c03-bc27-bbc716385723 ==============================
[0m02:41:28.193872 [info ] [MainThread]: Running with dbt=1.8.7
[0m02:41:28.194307 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:41:28.671841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61fb2ab0>]}
[0m02:41:28.689384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61898110>]}
[0m02:41:28.689810 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m02:41:28.732480 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m02:41:28.770515 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m02:41:28.770895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6163ae70>]}
[0m02:41:29.160575 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m02:41:29.161011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61463fb0>]}
[0m02:41:29.292389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff613bd6d0>]}
[0m02:41:29.345070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6163b920>]}
[0m02:41:29.345486 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 575 macros
[0m02:41:29.345928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff618fb530>]}
[0m02:41:29.346878 [info ] [MainThread]: 
[0m02:41:29.347307 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:41:29.349392 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m02:41:29.355929 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m02:41:29.356232 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m02:41:29.356419 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:41:30.221043 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.864 seconds
[0m02:41:30.223218 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m02:41:30.500257 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m02:41:30.505834 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m02:41:30.506085 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m02:41:30.506401 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:41:31.035141 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.528 seconds
[0m02:41:31.038991 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m02:41:31.176693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89668350>]}
[0m02:41:31.177978 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:41:31.179779 [info ] [MainThread]: 
[0m02:41:31.190491 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m02:41:31.191107 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m02:41:31.191818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now model.azm_meta_stock_analytics.stg_stock_price)
[0m02:41:31.192156 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m02:41:31.198233 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m02:41:31.200742 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m02:41:31.216246 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m02:41:31.217751 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m02:41:31.217984 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  );
[0m02:41:31.218199 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:31.999067 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.780 seconds
[0m02:41:32.020870 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m02:41:32.153108 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887f0e00>]}
[0m02:41:32.154680 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.96s]
[0m02:41:32.155745 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m02:41:32.157743 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m02:41:32.158677 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m02:41:32.159841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m02:41:32.160301 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m02:41:32.164221 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m02:41:32.166111 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m02:41:32.168377 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m02:41:32.171301 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m02:41:32.171813 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  );
[0m02:41:32.172265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:32.766123 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.594 seconds
[0m02:41:32.768377 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m02:41:32.900794 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60fd1c10>]}
[0m02:41:32.901617 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.74s]
[0m02:41:32.902416 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m02:41:32.903196 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m02:41:32.903634 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m02:41:32.904117 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m02:41:32.904453 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m02:41:32.906981 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m02:41:32.908801 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m02:41:32.922060 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m02:41:32.923615 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m02:41:32.923899 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m02:41:32.924179 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:35.065234 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.141 seconds
[0m02:41:35.066927 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m02:41:35.183891 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1e52f9b-3e46-4c03-bc27-bbc716385723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60fd09b0>]}
[0m02:41:35.184379 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 2.28s]
[0m02:41:35.184856 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m02:41:35.185657 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:41:35.185863 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m02:41:35.186074 [info ] [MainThread]: 
[0m02:41:35.186376 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.84 seconds (5.84s).
[0m02:41:35.186949 [debug] [MainThread]: Command end result
[0m02:41:35.208550 [info ] [MainThread]: 
[0m02:41:35.208981 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:41:35.209120 [info ] [MainThread]: 
[0m02:41:35.209291 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m02:41:35.209710 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.0514874, "process_user_time": 2.990287, "process_kernel_time": 0.178089, "process_mem_max_rss": "214488", "process_in_blocks": "61128", "process_out_blocks": "6154"}
[0m02:41:35.209916 [debug] [MainThread]: Command `dbt run` succeeded at 02:41:35.209878 after 7.05 seconds
[0m02:41:35.210074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff880c2840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61d23050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6189bda0>]}
[0m02:41:35.210223 [debug] [MainThread]: Flushing usage events
[0m02:41:37.251815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4a563f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3e267b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5b1fb90>]}


============================== 02:41:37.254829 | 27d79e8f-b81c-4ea4-af80-14104efc8627 ==============================
[0m02:41:37.254829 [info ] [MainThread]: Running with dbt=1.8.7
[0m02:41:37.255155 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:41:37.595838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb49fa450>]}
[0m02:41:37.613987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb524eab0>]}
[0m02:41:37.614456 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m02:41:37.655359 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m02:41:37.717763 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:41:37.718032 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:41:37.734522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cef1190>]}
[0m02:41:37.785337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cf03350>]}
[0m02:41:37.785652 [info ] [MainThread]: Found 3 models, 8 data tests, 1 source, 575 macros
[0m02:41:37.785904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d205340>]}
[0m02:41:37.786817 [info ] [MainThread]: 
[0m02:41:37.787107 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:41:37.788974 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m02:41:37.795706 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m02:41:37.795910 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m02:41:37.796049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:41:38.233932 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.438 seconds
[0m02:41:38.235770 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m02:41:38.398452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27d79e8f-b81c-4ea4-af80-14104efc8627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cdeaa80>]}
[0m02:41:38.399195 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:41:38.399597 [info ] [MainThread]: 
[0m02:41:38.408043 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m02:41:38.408505 [info ] [Thread-1 (]: 1 of 8 START test dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [RUN]
[0m02:41:38.408909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c)
[0m02:41:38.409240 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m02:41:38.420808 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m02:41:38.422410 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m02:41:38.435427 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m02:41:38.437000 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m02:41:38.437315 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        symbol, date
    from USER_DB_KOALA.analytics.stg_stock_price
    group by symbol, date
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m02:41:38.437551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:39.168066 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.730 seconds
[0m02:41:39.180127 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: Close
[0m02:41:39.399155 [info ] [Thread-1 (]: 1 of 8 PASS dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [[32mPASS[0m in 0.99s]
[0m02:41:39.400400 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m02:41:39.400935 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m02:41:39.401473 [info ] [Thread-1 (]: 2 of 8 START test not_null_stg_stock_price_close ............................... [RUN]
[0m02:41:39.402030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c, now test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af)
[0m02:41:39.402433 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m02:41:39.410133 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m02:41:39.411766 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m02:41:39.413913 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m02:41:39.415287 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m02:41:39.415623 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from USER_DB_KOALA.analytics.stg_stock_price
where close is null



      
    ) dbt_internal_test
[0m02:41:39.415939 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:39.951647 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.536 seconds
[0m02:41:39.953001 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: Close
[0m02:41:40.066327 [info ] [Thread-1 (]: 2 of 8 PASS not_null_stg_stock_price_close ..................................... [[32mPASS[0m in 0.66s]
[0m02:41:40.066752 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m02:41:40.066999 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m02:41:40.067246 [info ] [Thread-1 (]: 3 of 8 START test not_null_stg_stock_price_date ................................ [RUN]
[0m02:41:40.067497 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af, now test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd)
[0m02:41:40.067698 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m02:41:40.069625 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m02:41:40.070291 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m02:41:40.071307 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m02:41:40.071837 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m02:41:40.071987 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stg_stock_price
where date is null



      
    ) dbt_internal_test
[0m02:41:40.072114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:40.570769 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.497 seconds
[0m02:41:40.575329 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: Close
[0m02:41:40.693676 [info ] [Thread-1 (]: 3 of 8 PASS not_null_stg_stock_price_date ...................................... [[32mPASS[0m in 0.62s]
[0m02:41:40.695921 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m02:41:40.696839 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m02:41:40.697458 [info ] [Thread-1 (]: 4 of 8 START test not_null_stg_stock_price_symbol .............................. [RUN]
[0m02:41:40.698063 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd, now test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d)
[0m02:41:40.698665 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m02:41:40.703309 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m02:41:40.704763 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m02:41:40.706790 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m02:41:40.707821 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m02:41:40.708101 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stg_stock_price
where symbol is null



      
    ) dbt_internal_test
[0m02:41:40.708385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:41.142922 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.435 seconds
[0m02:41:41.143889 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: Close
[0m02:41:41.288466 [info ] [Thread-1 (]: 4 of 8 PASS not_null_stg_stock_price_symbol .................................... [[32mPASS[0m in 0.59s]
[0m02:41:41.289094 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m02:41:41.289548 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m02:41:41.289964 [info ] [Thread-1 (]: 5 of 8 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m02:41:41.290477 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m02:41:41.290833 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m02:41:41.294153 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m02:41:41.295185 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m02:41:41.298042 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m02:41:41.299037 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m02:41:41.299296 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m02:41:41.299538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:41.855818 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.556 seconds
[0m02:41:41.860591 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m02:41:41.986748 [info ] [Thread-1 (]: 5 of 8 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.70s]
[0m02:41:41.987700 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m02:41:41.988354 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m02:41:41.988954 [info ] [Thread-1 (]: 6 of 8 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m02:41:41.989554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m02:41:41.989949 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m02:41:41.994362 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m02:41:41.995708 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m02:41:41.997602 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m02:41:41.998821 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m02:41:41.999132 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m02:41:41.999457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:42.548451 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.549 seconds
[0m02:41:42.549705 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m02:41:42.683154 [info ] [Thread-1 (]: 6 of 8 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.69s]
[0m02:41:42.684068 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m02:41:42.684698 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m02:41:42.685272 [info ] [Thread-1 (]: 7 of 8 START test not_null_stock_transformations_date .......................... [RUN]
[0m02:41:42.685848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m02:41:42.686351 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m02:41:42.690534 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m02:41:42.691882 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m02:41:42.693815 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m02:41:42.694978 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m02:41:42.695312 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m02:41:42.695613 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:43.260151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.564 seconds
[0m02:41:43.261768 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m02:41:43.391625 [info ] [Thread-1 (]: 7 of 8 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.71s]
[0m02:41:43.392267 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m02:41:43.392659 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m02:41:43.393034 [info ] [Thread-1 (]: 8 of 8 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m02:41:43.393420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m02:41:43.393752 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m02:41:43.396795 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m02:41:43.397786 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m02:41:43.399282 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m02:41:43.400281 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m02:41:43.400552 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m02:41:43.400796 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:41:44.185903 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.785 seconds
[0m02:41:44.190417 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m02:41:44.320140 [info ] [Thread-1 (]: 8 of 8 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 0.93s]
[0m02:41:44.321191 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m02:41:44.322961 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:41:44.323407 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m02:41:44.323856 [info ] [MainThread]: 
[0m02:41:44.324309 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 6.54 seconds (6.54s).
[0m02:41:44.325658 [debug] [MainThread]: Command end result
[0m02:41:44.357115 [info ] [MainThread]: 
[0m02:41:44.357887 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:41:44.358357 [info ] [MainThread]: 
[0m02:41:44.358746 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m02:41:44.359686 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.145948, "process_user_time": 2.4997, "process_kernel_time": 0.126694, "process_mem_max_rss": "210480", "process_in_blocks": "1120", "process_out_blocks": "2512"}
[0m02:41:44.360152 [debug] [MainThread]: Command `dbt test` succeeded at 02:41:44.360057 after 7.15 seconds
[0m02:41:44.360582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4a563f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34a0b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb423ce30>]}
[0m02:41:44.360857 [debug] [MainThread]: Flushing usage events
[0m03:30:29.390325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d8e9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80b292e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d8f25d0>]}


============================== 03:30:29.394057 | 1793ba34-6970-4f48-a6ea-5894eec975bc ==============================
[0m03:30:29.394057 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:30:29.394494 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:30:29.734647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dab8590>]}
[0m03:30:29.751869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5317d970>]}
[0m03:30:29.752236 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:30:29.791373 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:30:29.861213 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m03:30:29.861538 [debug] [MainThread]: Partial parsing: added file: azm_meta_stock_analytics://snapshots/stock_price_snapshot.sql
[0m03:30:29.964061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff53073620>]}
[0m03:30:30.011695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff52e3cf80>]}
[0m03:30:30.011979 [info ] [MainThread]: Found 3 models, 8 data tests, 1 snapshot, 1 source, 575 macros
[0m03:30:30.012335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff530733b0>]}
[0m03:30:30.013071 [info ] [MainThread]: 
[0m03:30:30.013374 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:30:30.015011 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m03:30:30.020276 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m03:30:30.020452 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m03:30:30.020576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:30:30.504473 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.484 seconds
[0m03:30:30.506320 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m03:30:30.676547 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m03:30:30.685048 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:30:30.685478 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:30:30.685764 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:30:31.105325 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.420 seconds
[0m03:30:31.106525 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:30:31.241931 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:30:31.245600 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:30:31.246003 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:30:31.246329 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:30:31.659249 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.413 seconds
[0m03:30:31.661332 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:30:31.800174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff52cb17c0>]}
[0m03:30:31.801513 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:30:31.803001 [info ] [MainThread]: 
[0m03:30:31.813957 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:30:31.814605 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m03:30:31.815276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m03:30:31.815603 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m03:30:31.821495 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:30:31.822857 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m03:30:31.838567 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:30:31.839936 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:30:31.840186 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  );
[0m03:30:31.840414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:32.434651 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.594 seconds
[0m03:30:32.456998 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m03:30:32.802945 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff533857c0>]}
[0m03:30:32.804883 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.99s]
[0m03:30:32.806431 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:30:32.807591 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m03:30:32.808206 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m03:30:32.809043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m03:30:32.809412 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m03:30:32.813268 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:30:32.814758 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m03:30:32.818415 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:30:32.820969 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m03:30:32.821325 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  );
[0m03:30:32.821701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:33.456728 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.635 seconds
[0m03:30:33.458095 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m03:30:33.580854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff520e8080>]}
[0m03:30:33.581436 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.77s]
[0m03:30:33.582106 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m03:30:33.582751 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:30:33.583111 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m03:30:33.583596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m03:30:33.583949 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:30:33.585978 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:30:33.587082 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:30:33.598144 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:30:33.599403 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:30:33.599702 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m03:30:33.599990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:34.895421 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.295 seconds
[0m03:30:34.899952 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m03:30:35.040264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1793ba34-6970-4f48-a6ea-5894eec975bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff52ffbec0>]}
[0m03:30:35.041437 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.46s]
[0m03:30:35.042210 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:30:35.043822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:30:35.044231 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m03:30:35.044672 [info ] [MainThread]: 
[0m03:30:35.045267 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.03 seconds (5.03s).
[0m03:30:35.046124 [debug] [MainThread]: Command end result
[0m03:30:35.078217 [info ] [MainThread]: 
[0m03:30:35.078698 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:30:35.078892 [info ] [MainThread]: 
[0m03:30:35.079087 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m03:30:35.079572 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.720299, "process_user_time": 2.537377, "process_kernel_time": 0.16936, "process_mem_max_rss": "212072", "process_out_blocks": "3754", "process_in_blocks": "0"}
[0m03:30:35.079824 [debug] [MainThread]: Command `dbt run` succeeded at 03:30:35.079778 after 5.72 seconds
[0m03:30:35.080010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80b292e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5317dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dc8afc0>]}
[0m03:30:35.080187 [debug] [MainThread]: Flushing usage events
[0m03:30:37.432582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa42e540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa2c24b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa2b8500>]}


============================== 03:30:37.435359 | 939071a2-1ce4-424b-83bf-7e9580a3eba8 ==============================
[0m03:30:37.435359 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:30:37.435634 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m03:30:37.770791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3fa0800>]}
[0m03:30:37.787453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb94140>]}
[0m03:30:37.787798 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:30:37.824082 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:30:37.884389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:30:37.884607 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:30:37.902461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fa84110>]}
[0m03:30:37.951780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f69b380>]}
[0m03:30:37.952039 [info ] [MainThread]: Found 3 models, 8 data tests, 1 snapshot, 1 source, 575 macros
[0m03:30:37.952191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fb02480>]}
[0m03:30:37.952947 [info ] [MainThread]: 
[0m03:30:37.953211 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:30:37.954825 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_SNAPSHOT'
[0m03:30:37.961230 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:30:37.961394 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:30:37.961561 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:30:38.389122 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.427 seconds
[0m03:30:38.390799 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:30:38.502053 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m03:30:38.504095 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:30:38.504366 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:30:38.504595 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:30:38.909840 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.405 seconds
[0m03:30:38.911286 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:30:39.039744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '939071a2-1ce4-424b-83bf-7e9580a3eba8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f5e5f40>]}
[0m03:30:39.040101 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:30:39.040320 [info ] [MainThread]: 
[0m03:30:39.044572 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:30:39.044805 [info ] [Thread-1 (]: 1 of 8 START test dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [RUN]
[0m03:30:39.045047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c)
[0m03:30:39.045212 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:30:39.052124 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:30:39.053262 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:30:39.061361 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:30:39.062448 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:30:39.062658 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        symbol, date
    from USER_DB_KOALA.analytics.stg_stock_price
    group by symbol, date
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m03:30:39.062962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:39.486789 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.424 seconds
[0m03:30:39.492014 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: Close
[0m03:30:39.618512 [info ] [Thread-1 (]: 1 of 8 PASS dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [[32mPASS[0m in 0.57s]
[0m03:30:39.618934 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:30:39.619163 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:30:39.619366 [info ] [Thread-1 (]: 2 of 8 START test not_null_stg_stock_price_close ............................... [RUN]
[0m03:30:39.619581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c, now test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af)
[0m03:30:39.619742 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:30:39.622545 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:30:39.623206 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:30:39.624166 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:30:39.624651 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:30:39.624798 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from USER_DB_KOALA.analytics.stg_stock_price
where close is null



      
    ) dbt_internal_test
[0m03:30:39.624925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:40.036361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.411 seconds
[0m03:30:40.037474 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: Close
[0m03:30:40.151687 [info ] [Thread-1 (]: 2 of 8 PASS not_null_stg_stock_price_close ..................................... [[32mPASS[0m in 0.53s]
[0m03:30:40.152129 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:30:40.152349 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:30:40.152551 [info ] [Thread-1 (]: 3 of 8 START test not_null_stg_stock_price_date ................................ [RUN]
[0m03:30:40.152872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af, now test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd)
[0m03:30:40.153021 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:30:40.154904 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:30:40.155554 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:30:40.156517 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:30:40.157099 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:30:40.157301 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stg_stock_price
where date is null



      
    ) dbt_internal_test
[0m03:30:40.157499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:40.753048 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.595 seconds
[0m03:30:40.755850 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: Close
[0m03:30:40.869088 [info ] [Thread-1 (]: 3 of 8 PASS not_null_stg_stock_price_date ...................................... [[32mPASS[0m in 0.72s]
[0m03:30:40.869774 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:30:40.870002 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:30:40.870242 [info ] [Thread-1 (]: 4 of 8 START test not_null_stg_stock_price_symbol .............................. [RUN]
[0m03:30:40.870727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd, now test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d)
[0m03:30:40.870924 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:30:40.873386 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:30:40.874137 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:30:40.875464 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:30:40.876193 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:30:40.876403 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stg_stock_price
where symbol is null



      
    ) dbt_internal_test
[0m03:30:40.876612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:41.294769 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.418 seconds
[0m03:30:41.299171 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: Close
[0m03:30:41.436421 [info ] [Thread-1 (]: 4 of 8 PASS not_null_stg_stock_price_symbol .................................... [[32mPASS[0m in 0.56s]
[0m03:30:41.438363 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:30:41.438918 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:30:41.439383 [info ] [Thread-1 (]: 5 of 8 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m03:30:41.440213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m03:30:41.440672 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:30:41.445364 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:30:41.446822 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:30:41.448678 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:30:41.449849 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:30:41.450162 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m03:30:41.450526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:42.002036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.551 seconds
[0m03:30:42.003415 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m03:30:42.124139 [info ] [Thread-1 (]: 5 of 8 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.68s]
[0m03:30:42.125017 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:30:42.125334 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:30:42.125656 [info ] [Thread-1 (]: 6 of 8 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m03:30:42.126255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m03:30:42.126560 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:30:42.129675 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:30:42.130724 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:30:42.132396 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:30:42.133227 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:30:42.133476 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m03:30:42.133695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:42.575824 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.442 seconds
[0m03:30:42.578084 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m03:30:42.792184 [info ] [Thread-1 (]: 6 of 8 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.66s]
[0m03:30:42.793966 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:30:42.794514 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:30:42.795125 [info ] [Thread-1 (]: 7 of 8 START test not_null_stock_transformations_date .......................... [RUN]
[0m03:30:42.796093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m03:30:42.796463 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:30:42.800932 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:30:42.802330 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:30:42.804279 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:30:42.805410 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:30:42.805743 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m03:30:42.806042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:43.492385 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.686 seconds
[0m03:30:43.494199 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m03:30:43.650882 [info ] [Thread-1 (]: 7 of 8 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.85s]
[0m03:30:43.651942 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:30:43.652296 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:30:43.652667 [info ] [Thread-1 (]: 8 of 8 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m03:30:43.653379 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m03:30:43.653702 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:30:43.657247 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:30:43.658320 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:30:43.660076 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:30:43.661070 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:30:43.661369 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m03:30:43.661606 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:30:44.418734 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.756 seconds
[0m03:30:44.423178 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m03:30:44.556032 [info ] [Thread-1 (]: 8 of 8 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 0.90s]
[0m03:30:44.557040 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:30:44.558223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:30:44.558622 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m03:30:44.558923 [info ] [MainThread]: 
[0m03:30:44.559312 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 6.61 seconds (6.61s).
[0m03:30:44.560628 [debug] [MainThread]: Command end result
[0m03:30:44.586024 [info ] [MainThread]: 
[0m03:30:44.586507 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:30:44.586785 [info ] [MainThread]: 
[0m03:30:44.587083 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m03:30:44.587702 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.185637, "process_user_time": 2.495976, "process_kernel_time": 0.12917, "process_mem_max_rss": "209076", "process_out_blocks": "2528", "process_in_blocks": "0"}
[0m03:30:44.587938 [debug] [MainThread]: Command `dbt test` succeeded at 03:30:44.587892 after 7.19 seconds
[0m03:30:44.588113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaea0aab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac512b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9830f170>]}
[0m03:30:44.588289 [debug] [MainThread]: Flushing usage events
[0m03:31:43.878977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ea837a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa09973e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fb75f40>]}


============================== 03:31:43.881732 | 5907cacf-f34e-4701-95d5-02fe0e196c3e ==============================
[0m03:31:43.881732 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:31:43.882166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m03:31:44.210199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff927a2750>]}
[0m03:31:44.226887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73536720>]}
[0m03:31:44.227229 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:31:44.264892 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:31:44.343639 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:31:44.344042 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:31:44.365072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff733a30b0>]}
[0m03:31:44.421757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73027080>]}
[0m03:31:44.422105 [info ] [MainThread]: Found 3 models, 8 data tests, 1 snapshot, 1 source, 575 macros
[0m03:31:44.422596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73087080>]}
[0m03:31:44.423436 [info ] [MainThread]: 
[0m03:31:44.423900 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:31:44.425960 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m03:31:44.431809 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m03:31:44.432068 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m03:31:44.432297 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:31:44.932047 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.500 seconds
[0m03:31:44.933631 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m03:31:45.061474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m03:31:45.071206 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:31:45.071683 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:31:45.071982 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:31:45.487402 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.415 seconds
[0m03:31:45.488635 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:31:45.658351 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:31:45.662986 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:31:45.663369 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:31:45.663726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:31:46.101966 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.438 seconds
[0m03:31:46.105593 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:31:46.221379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f1600b0>]}
[0m03:31:46.221887 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:31:46.222491 [info ] [MainThread]: 
[0m03:31:46.228033 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:31:46.228407 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m03:31:46.228858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m03:31:46.229104 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m03:31:46.233268 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:31:46.234164 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m03:31:46.247974 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:31:46.249090 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:31:46.249300 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    -- Clean the raw stock price data loaded by Airflow

with src as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned as (
    select
        upper(trim(symbol)) as symbol,      -- ensure uppercase ticker (AMZN, META)
        try_to_date(date) as date,    -- ensure proper date type
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from src
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned
  );
[0m03:31:46.249500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:46.722399 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.473 seconds
[0m03:31:46.739226 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m03:31:46.852749 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e2e8dd0>]}
[0m03:31:46.854211 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.62s]
[0m03:31:46.855807 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:31:46.856774 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m03:31:46.857226 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m03:31:46.857967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m03:31:46.858733 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m03:31:46.861246 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:31:46.865721 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m03:31:46.868903 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:31:46.873331 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m03:31:46.874258 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    -- models/intermediate/int_stock_features.sql
-- Intermediate features for technical analysis:
--  - SMA 20/50/200
--  - Momentum (10-day)
--  - RSI (14)

with s as (
  -- Cleaned staging data
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

feat as (
  -- Core rolling features: SMA & Momentum
  select
    symbol,
    date,
    close,
    volume,

    -- Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- 10-day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from s
),

diffs as (
  -- Day-over-day change (Î”price)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from feat
),

gl as (
  -- Gains (positive Î”) and losses (positive magnitude of negative Î”)
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from diffs
),

rsi_roll as (
  -- Rolling averages over the last 14 changes INCLUDING the current one
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gl
),

final as (
  -- RSI from avg_gain/avg_loss with proper edge handling
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rsi_roll
)

-- Final output
select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final















-- with s as (
--   select * from USER_DB_KOALA.analytics.stg_stock_price
-- ),
-- feat as (
--   select
--     symbol,
--     date,
--     close,
--     volume,
--     avg(close) over (partition by symbol order by date rows between 19 preceding and current row)  as sma_20,
--     avg(close) over (partition by symbol order by date rows between 49 preceding and current row)  as sma_50,
--     avg(close) over (partition by symbol order by date rows between 199 preceding and current row) as sma_200,
--     (close - lag(close, 10) over (partition by symbol order by date)) as momentum_10
--   from s
-- ),
-- rsi as (
--   select
--     symbol, date, close, volume, sma_20, sma_50, sma_200, momentum_10,
--     case
--       when lag(close) over (partition by symbol order by date) is null then null
--       else 100 - 100 / (
--         1 + (
--           nullif(avg(greatest(close - lag(close) over (partition by symbol order by date), 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--           /
--           nullif(avg(greatest(lag(close) over (partition by symbol order by date) - close, 0))
--                  over (partition by symbol order by date rows between 14 preceding and 1 preceding),0)
--         )
--       )
--     end as rsi_14
--   from feat
-- )

-- select * from rsi;
  );
[0m03:31:46.875329 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:47.600882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.725 seconds
[0m03:31:47.602109 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m03:31:47.704469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72d897f0>]}
[0m03:31:47.705013 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.85s]
[0m03:31:47.705609 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m03:31:47.706094 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:31:47.706393 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m03:31:47.706805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m03:31:47.707067 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:31:47.708819 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:31:47.709661 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:31:47.719800 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:31:47.720788 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:31:47.721020 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  -- Trend regime based on moving averages
  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  -- RSI interpretation
  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  -- Momentum direction
  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  -- Combined trading suggestion
  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'       -- oversold but recovering
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'      -- overbought and dropping
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m03:31:47.721277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:49.301566 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.580 seconds
[0m03:31:49.306408 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m03:31:49.445887 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5907cacf-f34e-4701-95d5-02fe0e196c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7230f620>]}
[0m03:31:49.447476 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.74s]
[0m03:31:49.449182 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:31:49.450972 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:31:49.451387 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m03:31:49.451893 [info ] [MainThread]: 
[0m03:31:49.452525 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.03 seconds (5.03s).
[0m03:31:49.453317 [debug] [MainThread]: Command end result
[0m03:31:49.489468 [info ] [MainThread]: 
[0m03:31:49.490003 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:31:49.490180 [info ] [MainThread]: 
[0m03:31:49.490455 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m03:31:49.490998 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.6431975, "process_user_time": 2.460475, "process_kernel_time": 0.131506, "process_mem_max_rss": "209500", "process_out_blocks": "2537", "process_in_blocks": "0"}
[0m03:31:49.491263 [debug] [MainThread]: Command `dbt run` succeeded at 03:31:49.491209 after 5.64 seconds
[0m03:31:49.491471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dc52fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e592780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73086f00>]}
[0m03:31:49.491651 [debug] [MainThread]: Flushing usage events
[0m03:31:50.927154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfe1520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfe13d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfe1400>]}


============================== 03:31:50.929946 | a169f245-72eb-4b07-a928-c1da890e6cf0 ==============================
[0m03:31:50.929946 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:31:50.930377 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:31:51.263254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff626fda30>]}
[0m03:31:51.280902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff635844d0>]}
[0m03:31:51.281243 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:31:51.318913 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:31:51.387821 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:31:51.388060 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:31:51.406614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff625b9310>]}
[0m03:31:51.458505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff625bbf50>]}
[0m03:31:51.458789 [info ] [MainThread]: Found 3 models, 8 data tests, 1 snapshot, 1 source, 575 macros
[0m03:31:51.459171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff625f3cb0>]}
[0m03:31:51.460059 [info ] [MainThread]: 
[0m03:31:51.460458 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:31:51.462209 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m03:31:51.468427 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:31:51.468595 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:31:51.468755 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:31:51.990122 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.521 seconds
[0m03:31:51.991473 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:31:52.214863 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:31:52.218590 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:31:52.218931 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:31:52.219213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:31:52.669644 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.450 seconds
[0m03:31:52.673409 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:31:52.826888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a169f245-72eb-4b07-a928-c1da890e6cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e498500>]}
[0m03:31:52.828397 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:31:52.829515 [info ] [MainThread]: 
[0m03:31:52.838196 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:31:52.838852 [info ] [Thread-1 (]: 1 of 8 START test dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [RUN]
[0m03:31:52.839571 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c)
[0m03:31:52.839970 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:31:52.853583 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:31:52.854952 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:31:52.866830 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:31:52.867926 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"
[0m03:31:52.868185 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        symbol, date
    from USER_DB_KOALA.analytics.stg_stock_price
    group by symbol, date
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m03:31:52.868472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:53.289892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.421 seconds
[0m03:31:53.293809 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c: Close
[0m03:31:53.410557 [info ] [Thread-1 (]: 1 of 8 PASS dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date  [[32mPASS[0m in 0.57s]
[0m03:31:53.411102 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c
[0m03:31:53.413186 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:31:53.413590 [info ] [Thread-1 (]: 2 of 8 START test not_null_stg_stock_price_close ............................... [RUN]
[0m03:31:53.413928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.dbt_utils_unique_combination_of_columns_stg_stock_price_symbol__date.401905b31c, now test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af)
[0m03:31:53.414211 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:31:53.417147 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:31:53.417812 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:31:53.418802 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:31:53.419451 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"
[0m03:31:53.419617 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from USER_DB_KOALA.analytics.stg_stock_price
where close is null



      
    ) dbt_internal_test
[0m03:31:53.419772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:53.904464 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.485 seconds
[0m03:31:53.905562 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af: Close
[0m03:31:54.016902 [info ] [Thread-1 (]: 2 of 8 PASS not_null_stg_stock_price_close ..................................... [[32mPASS[0m in 0.60s]
[0m03:31:54.017780 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af
[0m03:31:54.018250 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:31:54.018507 [info ] [Thread-1 (]: 3 of 8 START test not_null_stg_stock_price_date ................................ [RUN]
[0m03:31:54.018891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_close.d5dbc233af, now test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd)
[0m03:31:54.019201 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:31:54.021680 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:31:54.022316 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:31:54.023558 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:31:54.024248 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"
[0m03:31:54.024436 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stg_stock_price
where date is null



      
    ) dbt_internal_test
[0m03:31:54.024609 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:54.407971 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.383 seconds
[0m03:31:54.409199 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd: Close
[0m03:31:54.520670 [info ] [Thread-1 (]: 3 of 8 PASS not_null_stg_stock_price_date ...................................... [[32mPASS[0m in 0.50s]
[0m03:31:54.521228 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd
[0m03:31:54.521598 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:31:54.521942 [info ] [Thread-1 (]: 4 of 8 START test not_null_stg_stock_price_symbol .............................. [RUN]
[0m03:31:54.522317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_date.c579c417cd, now test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d)
[0m03:31:54.522605 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:31:54.525138 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:31:54.525956 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:31:54.527323 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:31:54.528150 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"
[0m03:31:54.528374 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stg_stock_price
where symbol is null



      
    ) dbt_internal_test
[0m03:31:54.528610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:55.100151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.571 seconds
[0m03:31:55.101485 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d: Close
[0m03:31:55.219682 [info ] [Thread-1 (]: 4 of 8 PASS not_null_stg_stock_price_symbol .................................... [[32mPASS[0m in 0.70s]
[0m03:31:55.220209 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d
[0m03:31:55.220527 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:31:55.220820 [info ] [Thread-1 (]: 5 of 8 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m03:31:55.221240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stg_stock_price_symbol.691ecef82d, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m03:31:55.221481 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:31:55.223971 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:31:55.224708 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:31:55.226027 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:31:55.226769 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:31:55.227011 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m03:31:55.227217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:55.793734 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.566 seconds
[0m03:31:55.798613 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m03:31:55.925499 [info ] [Thread-1 (]: 5 of 8 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.70s]
[0m03:31:55.926589 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:31:55.927203 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:31:55.927855 [info ] [Thread-1 (]: 6 of 8 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m03:31:55.928475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m03:31:55.928845 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:31:55.933140 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:31:55.934503 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:31:55.936323 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:31:55.937469 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:31:55.937775 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m03:31:55.938075 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:56.365997 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.428 seconds
[0m03:31:56.368029 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m03:31:56.499323 [info ] [Thread-1 (]: 6 of 8 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.57s]
[0m03:31:56.500121 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:31:56.500619 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:31:56.501018 [info ] [Thread-1 (]: 7 of 8 START test not_null_stock_transformations_date .......................... [RUN]
[0m03:31:56.501476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m03:31:56.501770 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:31:56.505438 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:31:56.506489 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:31:56.508210 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:31:56.509228 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:31:56.509536 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m03:31:56.509762 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:57.041103 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.531 seconds
[0m03:31:57.042446 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m03:31:57.201008 [info ] [Thread-1 (]: 7 of 8 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.70s]
[0m03:31:57.201553 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:31:57.201843 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:31:57.202082 [info ] [Thread-1 (]: 8 of 8 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m03:31:57.202342 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m03:31:57.202554 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:31:57.205231 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:31:57.205960 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:31:57.207351 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:31:57.208156 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:31:57.208399 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m03:31:57.208604 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:31:58.347840 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.139 seconds
[0m03:31:58.348940 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m03:31:58.469524 [info ] [Thread-1 (]: 8 of 8 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 1.27s]
[0m03:31:58.470268 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:31:58.471798 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:31:58.472141 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m03:31:58.472497 [info ] [MainThread]: 
[0m03:31:58.472799 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 7.01 seconds (7.01s).
[0m03:31:58.473910 [debug] [MainThread]: Command end result
[0m03:31:58.499479 [info ] [MainThread]: 
[0m03:31:58.499759 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:31:58.499923 [info ] [MainThread]: 
[0m03:31:58.500105 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m03:31:58.500602 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.605548, "process_user_time": 2.511401, "process_kernel_time": 0.133021, "process_mem_max_rss": "211036", "process_out_blocks": "2528", "process_in_blocks": "0"}
[0m03:31:58.500839 [debug] [MainThread]: Command `dbt test` succeeded at 03:31:58.500793 after 7.61 seconds
[0m03:31:58.501016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd95970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cbeac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfe1520>]}
[0m03:31:58.501175 [debug] [MainThread]: Flushing usage events
[0m03:32:01.010086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f7ceea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f65e4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa25d3080>]}


============================== 03:32:01.012890 | f5914178-e932-4caf-97a4-dec089000d94 ==============================
[0m03:32:01.012890 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:32:01.013310 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:32:01.336474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78f3d970>]}
[0m03:32:01.353762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ebdf260>]}
[0m03:32:01.354105 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:32:01.392470 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:32:01.461380 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:32:01.461683 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:32:01.484542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78b516d0>]}
[0m03:32:01.539260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff789766f0>]}
[0m03:32:01.539591 [info ] [MainThread]: Found 3 models, 8 data tests, 1 snapshot, 1 source, 575 macros
[0m03:32:01.539965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff788becf0>]}
[0m03:32:01.540792 [info ] [MainThread]: 
[0m03:32:01.541137 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:32:01.541626 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m03:32:01.547872 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m03:32:01.548139 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m03:32:01.548321 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:32:02.239719 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.691 seconds
[0m03:32:02.241043 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m03:32:02.384089 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m03:32:02.392814 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:32:02.393198 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:32:02.393491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:32:02.780194 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.387 seconds
[0m03:32:02.782068 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:32:02.896009 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:32:02.902234 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:32:02.902895 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:32:02.903315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:32:03.282234 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.379 seconds
[0m03:32:03.284502 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:32:03.408086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78c01670>]}
[0m03:32:03.408480 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:32:03.408926 [info ] [MainThread]: 
[0m03:32:03.413277 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:32:03.413603 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m03:32:03.414006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m03:32:03.414253 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:32:03.422461 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:32:03.447641 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:03.447938 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m03:32:03.448150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:32:03.813376 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.365 seconds
[0m03:32:03.818201 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:03.818541 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:32:03.902751 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.084 seconds
[0m03:32:03.908521 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:03.908964 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:32:03.995975 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.087 seconds
[0m03:32:04.025564 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:04.025928 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:32:04.766405 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.740 seconds
[0m03:32:04.769272 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:04.769816 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:32:04.867439 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.097 seconds
[0m03:32:04.869356 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:04.869585 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:32:04.950266 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.080 seconds
[0m03:32:04.953519 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:04.953794 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:32:05.069903 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.116 seconds
[0m03:32:05.074234 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.074691 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:32:05.164220 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.089 seconds
[0m03:32:05.173799 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.174342 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:32:05.265351 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.090 seconds
[0m03:32:05.286277 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.287206 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m03:32:05.621762 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.334 seconds
[0m03:32:05.628515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.629263 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m03:32:05.700578 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.071 seconds
[0m03:32:05.701445 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.703410 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.704679 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m03:32:05.871209 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.166 seconds
[0m03:32:05.872067 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:05.872691 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:32:06.544608 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.671 seconds
[0m03:32:06.546311 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:32:06.547316 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m03:32:06.847700 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.300 seconds
[0m03:32:06.864182 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m03:32:06.967550 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5914178-e932-4caf-97a4-dec089000d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fb98a40>]}
[0m03:32:06.968879 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 3.55s]
[0m03:32:06.969427 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:32:06.970383 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:32:06.970673 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m03:32:06.970886 [info ] [MainThread]: 
[0m03:32:06.971052 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.43 seconds (5.43s).
[0m03:32:06.971394 [debug] [MainThread]: Command end result
[0m03:32:06.996684 [info ] [MainThread]: 
[0m03:32:06.997125 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:32:06.997265 [info ] [MainThread]: 
[0m03:32:06.997473 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m03:32:06.997959 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.019047, "process_user_time": 2.495311, "process_kernel_time": 0.138572, "process_mem_max_rss": "212152", "process_in_blocks": "8", "process_out_blocks": "2509"}
[0m03:32:06.998189 [debug] [MainThread]: Command `dbt snapshot` succeeded at 03:32:06.998147 after 6.02 seconds
[0m03:32:06.998376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f65e4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f395640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78b83bf0>]}
[0m03:32:06.998614 [debug] [MainThread]: Flushing usage events
[0m03:52:42.536824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90c237d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fe454c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92b27230>]}


============================== 03:52:42.539710 | f5c6d27a-2411-40e5-a5ce-0f08fd8c751a ==============================
[0m03:52:42.539710 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:52:42.540170 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:52:42.868657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91496bd0>]}
[0m03:52:42.886138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69583470>]}
[0m03:52:42.886487 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:52:42.925942 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:52:42.997895 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 5 files changed.
[0m03:52:42.998393 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/sources.yml
[0m03:52:42.998610 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/schema.yml
[0m03:52:42.998778 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/output/stock_price_technical_indicators.sql
[0m03:52:42.998925 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/staging/stg_stock_price.sql
[0m03:52:42.999066 [debug] [MainThread]: Partial parsing: updated file: azm_meta_stock_analytics://models/intermediate/stock_transformations.sql
[0m03:52:43.122974 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m03:52:43.123419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff831b6960>]}
[0m03:52:43.206979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f6ac90>]}
[0m03:52:43.255525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff687d87a0>]}
[0m03:52:43.255820 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m03:52:43.256147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69581400>]}
[0m03:52:43.256888 [info ] [MainThread]: 
[0m03:52:43.257196 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:52:43.258935 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m03:52:43.264174 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m03:52:43.264338 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m03:52:43.264484 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:52:43.759299 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.495 seconds
[0m03:52:43.761483 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m03:52:43.891903 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m03:52:43.931818 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:52:43.932091 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:52:43.932241 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:52:44.363417 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.431 seconds
[0m03:52:44.367712 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:52:44.512284 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:52:44.518078 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:52:44.518530 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:52:44.518886 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:52:44.908233 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.389 seconds
[0m03:52:44.909213 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:52:45.053910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff687d87a0>]}
[0m03:52:45.054601 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:52:45.055406 [info ] [MainThread]: 
[0m03:52:45.063828 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:52:45.064374 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m03:52:45.064965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m03:52:45.065264 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m03:52:45.070486 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:52:45.071982 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m03:52:45.087160 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:52:45.088697 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m03:52:45.089001 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m03:52:45.089289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:45.627411 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.538 seconds
[0m03:52:45.650641 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m03:52:45.780641 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90488ef0>]}
[0m03:52:45.781352 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.71s]
[0m03:52:45.782161 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m03:52:45.783053 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m03:52:45.783571 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m03:52:45.784140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m03:52:45.784475 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m03:52:45.786927 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:52:45.788171 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m03:52:45.790028 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m03:52:45.793497 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m03:52:45.793828 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m03:52:45.794136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:46.366284 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.572 seconds
[0m03:52:46.371404 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m03:52:46.522648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f61c10>]}
[0m03:52:46.524648 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.74s]
[0m03:52:46.526186 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m03:52:46.527346 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:52:46.527986 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m03:52:46.528662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m03:52:46.529055 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:52:46.532341 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:52:46.534058 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:52:46.548836 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:52:46.550383 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m03:52:46.550719 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m03:52:46.551018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:48.262996 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.712 seconds
[0m03:52:48.265969 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m03:52:48.396555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5c6d27a-2411-40e5-a5ce-0f08fd8c751a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f62fc0>]}
[0m03:52:48.398336 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.87s]
[0m03:52:48.400219 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m03:52:48.402377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:52:48.402758 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m03:52:48.403315 [info ] [MainThread]: 
[0m03:52:48.404000 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.15 seconds (5.15s).
[0m03:52:48.404873 [debug] [MainThread]: Command end result
[0m03:52:48.440479 [info ] [MainThread]: 
[0m03:52:48.440962 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:52:48.441190 [info ] [MainThread]: 
[0m03:52:48.441453 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m03:52:48.442013 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9380546, "process_user_time": 2.698181, "process_kernel_time": 0.133157, "process_mem_max_rss": "217976", "process_out_blocks": "3654", "process_in_blocks": "0"}
[0m03:52:48.442293 [debug] [MainThread]: Command `dbt run` succeeded at 03:52:48.442243 after 5.94 seconds
[0m03:52:48.442514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fdfd4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90a75bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68bd1820>]}
[0m03:52:48.442722 [debug] [MainThread]: Flushing usage events
[0m03:52:50.567646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c39ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1569b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa02755b0>]}


============================== 03:52:50.570484 | d71e242b-b911-494a-8d7e-599342531e43 ==============================
[0m03:52:50.570484 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:52:50.570968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:52:50.906711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa18c6db0>]}
[0m03:52:50.925134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0b12060>]}
[0m03:52:50.925632 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:52:50.965162 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:52:51.035914 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:52:51.036170 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:52:51.054421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff795b3fe0>]}
[0m03:52:51.105725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff794abaa0>]}
[0m03:52:51.106020 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m03:52:51.106377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7986e600>]}
[0m03:52:51.107175 [info ] [MainThread]: 
[0m03:52:51.107607 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:52:51.109354 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m03:52:51.115563 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:52:51.115725 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:52:51.115887 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:52:51.613073 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.497 seconds
[0m03:52:51.615534 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:52:51.766746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:52:51.771331 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:52:51.771779 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:52:51.772162 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:52:52.202734 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.430 seconds
[0m03:52:52.206560 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:52:52.335003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd71e242b-b911-494a-8d7e-599342531e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa172c2f0>]}
[0m03:52:52.335486 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:52:52.336061 [info ] [MainThread]: 
[0m03:52:52.342544 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:52:52.342979 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m03:52:52.343697 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m03:52:52.344083 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:52:52.352969 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:52:52.354571 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:52:52.364879 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:52:52.366185 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m03:52:52.366444 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m03:52:52.366722 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:52.859714 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.493 seconds
[0m03:52:52.870821 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m03:52:53.031500 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.69s]
[0m03:52:53.033017 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m03:52:53.033644 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:52:53.034218 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m03:52:53.035007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m03:52:53.035371 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:52:53.039750 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:52:53.041250 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:52:53.043093 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:52:53.044344 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m03:52:53.044718 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m03:52:53.045030 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:53.394940 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.350 seconds
[0m03:52:53.397723 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m03:52:53.533608 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.50s]
[0m03:52:53.534187 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m03:52:53.534408 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:52:53.534618 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m03:52:53.534969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m03:52:53.535184 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:52:53.537115 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:52:53.537827 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:52:53.538745 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:52:53.539459 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m03:52:53.539630 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m03:52:53.539802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:54.045432 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.505 seconds
[0m03:52:54.047532 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m03:52:54.158093 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.62s]
[0m03:52:54.160749 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m03:52:54.162146 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:52:54.163068 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m03:52:54.164054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m03:52:54.164567 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:52:54.169191 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:52:54.171759 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:52:54.173600 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:52:54.174885 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m03:52:54.175212 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m03:52:54.175590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:54.815985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.640 seconds
[0m03:52:54.818007 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m03:52:54.925336 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 0.76s]
[0m03:52:54.926258 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m03:52:54.927468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:52:54.927771 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m03:52:54.928106 [info ] [MainThread]: 
[0m03:52:54.928609 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 3.82 seconds (3.82s).
[0m03:52:54.929515 [debug] [MainThread]: Command end result
[0m03:52:54.958024 [info ] [MainThread]: 
[0m03:52:54.958421 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:52:54.958624 [info ] [MainThread]: 
[0m03:52:54.958835 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m03:52:54.959311 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.4244947, "process_user_time": 2.442226, "process_kernel_time": 0.117154, "process_mem_max_rss": "210384", "process_out_blocks": "2433", "process_in_blocks": "0"}
[0m03:52:54.959558 [debug] [MainThread]: Command `dbt test` succeeded at 03:52:54.959512 after 4.42 seconds
[0m03:52:54.959744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0459940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa02755b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0275550>]}
[0m03:52:54.959944 [debug] [MainThread]: Flushing usage events
[0m03:52:57.163340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885e5940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87ab2e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8980f860>]}


============================== 03:52:57.166149 | 08599828-ec2d-4ba8-a56a-93bc11c7bf6f ==============================
[0m03:52:57.166149 [info ] [MainThread]: Running with dbt=1.8.7
[0m03:52:57.166599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:52:57.510544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff611f7950>]}
[0m03:52:57.527986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a5efb30>]}
[0m03:52:57.528292 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:52:57.566275 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m03:52:57.636252 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:52:57.636489 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:52:57.654987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6108f590>]}
[0m03:52:57.707335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60e58110>]}
[0m03:52:57.707623 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m03:52:57.707993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff707564b0>]}
[0m03:52:57.708861 [info ] [MainThread]: 
[0m03:52:57.709248 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:52:57.709724 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m03:52:57.716193 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m03:52:57.716698 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m03:52:57.717086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:52:58.111851 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.395 seconds
[0m03:52:58.113483 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m03:52:58.237891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_SNAPSHOT)
[0m03:52:58.247411 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m03:52:58.247970 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m03:52:58.248359 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:52:58.640018 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.391 seconds
[0m03:52:58.643023 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m03:52:58.762976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m03:52:58.764445 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m03:52:58.764639 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m03:52:58.765171 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:52:59.203235 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.438 seconds
[0m03:52:59.208269 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m03:52:59.368002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60c7d5b0>]}
[0m03:52:59.369520 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:52:59.370856 [info ] [MainThread]: 
[0m03:52:59.381232 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:52:59.381864 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m03:52:59.382530 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m03:52:59.382891 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:52:59.396171 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:52:59.426361 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:52:59.426653 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m03:52:59.426872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:52:59.880708 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.454 seconds
[0m03:52:59.884944 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:52:59.885447 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:52:59.956807 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.071 seconds
[0m03:52:59.960193 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:52:59.960384 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:53:00.060308 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.100 seconds
[0m03:53:00.082026 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:00.082366 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:53:01.265050 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.182 seconds
[0m03:53:01.267270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.267582 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:53:01.342079 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.074 seconds
[0m03:53:01.345148 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.345526 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:53:01.419025 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.073 seconds
[0m03:53:01.422718 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.423123 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:53:01.522054 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.098 seconds
[0m03:53:01.528895 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.529772 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m03:53:01.618928 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.088 seconds
[0m03:53:01.626060 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.626477 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m03:53:01.737765 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.111 seconds
[0m03:53:01.758541 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:01.759106 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m03:53:02.085489 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.326 seconds
[0m03:53:02.087370 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:02.087681 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m03:53:02.174841 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.087 seconds
[0m03:53:02.175353 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:02.176692 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:02.176956 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m03:53:02.265855 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m03:53:02.266225 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:02.266523 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:53:02.908927 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.642 seconds
[0m03:53:02.911056 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m03:53:02.912028 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m03:53:03.314708 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.401 seconds
[0m03:53:03.328141 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m03:53:03.443116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08599828-ec2d-4ba8-a56a-93bc11c7bf6f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88140c50>]}
[0m03:53:03.444157 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 4.06s]
[0m03:53:03.445194 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m03:53:03.446703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:53:03.447090 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m03:53:03.447398 [info ] [MainThread]: 
[0m03:53:03.447894 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.74 seconds (5.74s).
[0m03:53:03.449085 [debug] [MainThread]: Command end result
[0m03:53:03.482261 [info ] [MainThread]: 
[0m03:53:03.482771 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:53:03.482950 [info ] [MainThread]: 
[0m03:53:03.483369 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m03:53:03.483924 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.3516946, "process_user_time": 2.576788, "process_kernel_time": 0.121319, "process_mem_max_rss": "212004", "process_out_blocks": "2448", "process_in_blocks": "0"}
[0m03:53:03.484179 [debug] [MainThread]: Command `dbt snapshot` succeeded at 03:53:03.484133 after 6.35 seconds
[0m03:53:03.484403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885e5940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a255940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87da51c0>]}
[0m03:53:03.484646 [debug] [MainThread]: Flushing usage events
[0m04:06:28.354653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9597380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb237b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb93052e0>]}


============================== 04:06:28.357503 | 0732809f-bb41-4727-b201-dcf84312eafb ==============================
[0m04:06:28.357503 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:06:28.357916 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m04:06:28.689959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ef5ff20>]}
[0m04:06:28.707344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa69575f0>]}
[0m04:06:28.707915 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:06:28.746942 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:06:28.817613 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:06:28.817867 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:06:28.835892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e8f4110>]}
[0m04:06:28.896029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e6e4e60>]}
[0m04:06:28.896369 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:06:28.896789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e66f770>]}
[0m04:06:28.897711 [info ] [MainThread]: 
[0m04:06:28.898115 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:06:28.900283 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m04:06:28.906670 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m04:06:28.906928 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m04:06:28.907122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:06:29.574357 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.667 seconds
[0m04:06:29.575551 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m04:06:29.823543 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m04:06:29.832354 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:06:29.832762 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:06:29.833054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:06:30.330825 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.498 seconds
[0m04:06:30.333538 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:06:30.457460 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:06:30.461227 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:06:30.461698 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:06:30.462015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:06:30.840183 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.378 seconds
[0m04:06:30.844067 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:06:31.329533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ea2cbf0>]}
[0m04:06:31.330267 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:06:31.330924 [info ] [MainThread]: 
[0m04:06:31.339109 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m04:06:31.339668 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m04:06:31.340191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m04:06:31.340534 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m04:06:31.345864 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:06:31.347160 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m04:06:31.362936 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:06:31.364232 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:06:31.364479 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m04:06:31.364708 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:32.186154 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.821 seconds
[0m04:06:32.207507 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m04:06:32.352290 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9994bc0>]}
[0m04:06:32.353079 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 1.01s]
[0m04:06:32.353886 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m04:06:32.354698 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m04:06:32.355129 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m04:06:32.355687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m04:06:32.356163 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m04:06:32.358765 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m04:06:32.359936 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m04:06:32.361802 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m04:06:32.364094 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m04:06:32.364410 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m04:06:32.364697 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:33.070552 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.706 seconds
[0m04:06:33.071634 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m04:06:33.202547 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dbc4ce0>]}
[0m04:06:33.203002 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.85s]
[0m04:06:33.203557 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m04:06:33.204080 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:06:33.204314 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m04:06:33.204677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m04:06:33.204831 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:06:33.206206 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:06:33.206998 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:06:33.214542 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:06:33.215569 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:06:33.215765 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m04:06:33.215938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:35.359313 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.143 seconds
[0m04:06:35.363778 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m04:06:35.496591 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0732809f-bb41-4727-b201-dcf84312eafb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db8cef0>]}
[0m04:06:35.497910 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 2.29s]
[0m04:06:35.499221 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:06:35.500844 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:06:35.501267 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m04:06:35.501717 [info ] [MainThread]: 
[0m04:06:35.502258 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 6.60 seconds (6.60s).
[0m04:06:35.503090 [debug] [MainThread]: Command end result
[0m04:06:35.535751 [info ] [MainThread]: 
[0m04:06:35.536122 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:06:35.536300 [info ] [MainThread]: 
[0m04:06:35.536555 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m04:06:35.537060 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.2149425, "process_user_time": 2.347965, "process_kernel_time": 0.118098, "process_mem_max_rss": "209464", "process_out_blocks": "2456", "process_in_blocks": "0"}
[0m04:06:35.537320 [debug] [MainThread]: Command `dbt run` succeeded at 04:06:35.537272 after 7.22 seconds
[0m04:06:35.537522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb95cdb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb95f9b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba1accb0>]}
[0m04:06:35.537697 [debug] [MainThread]: Flushing usage events
[0m04:06:37.171419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff976237d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9706c920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff974bc5c0>]}


============================== 04:06:37.174783 | b051e3e1-6f87-470e-bb16-7b7abd0d1bc6 ==============================
[0m04:06:37.174783 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:06:37.175067 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:06:37.529569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7120a4e0>]}
[0m04:06:37.550505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71fc17c0>]}
[0m04:06:37.552781 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:06:37.626039 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:06:37.725614 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:06:37.725887 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:06:37.744602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7045d3d0>]}
[0m04:06:37.796784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff704428d0>]}
[0m04:06:37.797059 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:06:37.797247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71da4260>]}
[0m04:06:37.798016 [info ] [MainThread]: 
[0m04:06:37.798319 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:06:37.800095 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m04:06:37.806614 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:06:37.806816 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:06:37.807019 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:06:38.219545 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.412 seconds
[0m04:06:38.220686 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:06:38.360662 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:06:38.363577 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:06:38.363876 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:06:38.364123 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:06:38.725676 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.361 seconds
[0m04:06:38.727658 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:06:38.893360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b051e3e1-6f87-470e-bb16-7b7abd0d1bc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98300080>]}
[0m04:06:38.895160 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:06:38.895950 [info ] [MainThread]: 
[0m04:06:38.905635 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:06:38.906092 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m04:06:38.906559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m04:06:38.906873 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:06:38.918140 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:06:38.919596 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:06:38.931392 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:06:38.932496 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:06:38.932757 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m04:06:38.932997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:39.446140 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.513 seconds
[0m04:06:39.455114 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m04:06:39.582920 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.68s]
[0m04:06:39.584214 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:06:39.584836 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:06:39.585265 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m04:06:39.585686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m04:06:39.585963 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:06:39.589725 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:06:39.590708 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:06:39.592450 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:06:39.593621 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:06:39.593920 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m04:06:39.594162 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:40.034635 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.440 seconds
[0m04:06:40.037120 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m04:06:40.168671 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.58s]
[0m04:06:40.170313 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:06:40.170928 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:06:40.171444 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m04:06:40.172123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m04:06:40.172633 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:06:40.176897 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:06:40.178265 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:06:40.180255 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:06:40.181575 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:06:40.181892 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m04:06:40.182261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:40.686505 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.504 seconds
[0m04:06:40.689098 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m04:06:40.801714 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.63s]
[0m04:06:40.802407 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:06:40.802828 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:06:40.803156 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m04:06:40.803619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m04:06:40.803998 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:06:40.807001 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:06:40.808777 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:06:40.810345 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:06:40.811251 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:06:40.811527 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m04:06:40.811779 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:41.317756 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.506 seconds
[0m04:06:41.318905 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m04:06:41.441280 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 0.64s]
[0m04:06:41.442069 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:06:41.443579 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:06:41.443936 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m04:06:41.444312 [info ] [MainThread]: 
[0m04:06:41.444746 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 3.65 seconds (3.65s).
[0m04:06:41.445805 [debug] [MainThread]: Command end result
[0m04:06:41.472776 [info ] [MainThread]: 
[0m04:06:41.473055 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:06:41.473215 [info ] [MainThread]: 
[0m04:06:41.473389 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m04:06:41.473888 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.3426833, "process_user_time": 2.286242, "process_kernel_time": 0.127347, "process_mem_max_rss": "208188", "process_in_blocks": "3160", "process_out_blocks": "2433"}
[0m04:06:41.474134 [debug] [MainThread]: Command `dbt test` succeeded at 04:06:41.474087 after 4.34 seconds
[0m04:06:41.474397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97222900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6bfc6690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97a491f0>]}
[0m04:06:41.474582 [debug] [MainThread]: Flushing usage events
[0m04:06:43.427746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9528e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94c42ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94d42450>]}


============================== 04:06:43.430648 | 700b1c59-3fff-4d8c-843a-9fe7bc46cca7 ==============================
[0m04:06:43.430648 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:06:43.431115 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:06:43.752947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e9ffda0>]}
[0m04:06:43.770189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e593b00>]}
[0m04:06:43.770555 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:06:43.807491 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:06:43.875354 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:06:43.875611 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:06:43.893427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e2a4ce0>]}
[0m04:06:43.940627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e09a870>]}
[0m04:06:43.940888 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:06:43.941236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e249100>]}
[0m04:06:43.942036 [info ] [MainThread]: 
[0m04:06:43.942354 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:06:43.942801 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m04:06:43.948556 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m04:06:43.948748 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m04:06:43.948911 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:06:44.457604 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.509 seconds
[0m04:06:44.458526 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m04:06:44.629019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m04:06:44.637064 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:06:44.637455 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:06:44.637784 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:06:45.018859 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.381 seconds
[0m04:06:45.021939 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:06:45.172027 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:06:45.175972 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:06:45.176424 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:06:45.176804 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:06:45.528808 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.352 seconds
[0m04:06:45.529940 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:06:45.785887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff960e3fb0>]}
[0m04:06:45.786848 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:06:45.787746 [info ] [MainThread]: 
[0m04:06:45.796984 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:06:45.797520 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m04:06:45.798140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m04:06:45.798466 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:06:45.810985 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:06:45.841271 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:45.841522 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m04:06:45.841769 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:06:46.364714 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.523 seconds
[0m04:06:46.373957 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:46.374483 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:06:46.460112 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.085 seconds
[0m04:06:46.467213 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:46.467557 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:06:46.555956 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.088 seconds
[0m04:06:46.573427 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:46.573719 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m04:06:47.443334 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.869 seconds
[0m04:06:47.449797 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:47.450518 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:06:47.523800 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.072 seconds
[0m04:06:47.529376 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:47.529968 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:06:47.657269 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.127 seconds
[0m04:06:47.659995 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:47.660243 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:06:47.755515 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.095 seconds
[0m04:06:47.757612 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:47.757828 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:06:47.835587 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.078 seconds
[0m04:06:47.841549 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:47.841865 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:06:47.987553 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.145 seconds
[0m04:06:48.004970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:48.005447 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m04:06:48.326361 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.320 seconds
[0m04:06:48.332670 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:48.333591 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m04:06:48.412886 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.078 seconds
[0m04:06:48.414805 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:48.419942 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:48.420455 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m04:06:48.507510 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m04:06:48.509250 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:48.509801 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m04:06:49.078866 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.568 seconds
[0m04:06:49.079818 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:06:49.080288 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m04:06:49.385792 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.305 seconds
[0m04:06:49.403256 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m04:06:49.541500 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '700b1c59-3fff-4d8c-843a-9fe7bc46cca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c9092e0>]}
[0m04:06:49.542809 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 3.74s]
[0m04:06:49.544093 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:06:49.546122 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:06:49.546503 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m04:06:49.546831 [info ] [MainThread]: 
[0m04:06:49.547822 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.60 seconds (5.60s).
[0m04:06:49.548647 [debug] [MainThread]: Command end result
[0m04:06:49.578471 [info ] [MainThread]: 
[0m04:06:49.578957 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:06:49.579132 [info ] [MainThread]: 
[0m04:06:49.579331 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:06:49.579825 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.1868224, "process_user_time": 2.497113, "process_kernel_time": 0.120101, "process_mem_max_rss": "208180", "process_out_blocks": "2448", "process_in_blocks": "0"}
[0m04:06:49.580115 [debug] [MainThread]: Command `dbt snapshot` succeeded at 04:06:49.580046 after 6.19 seconds
[0m04:06:49.580339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e51f530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f978890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94eedd60>]}
[0m04:06:49.580525 [debug] [MainThread]: Flushing usage events
[0m04:11:59.665160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eb52c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ecae7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa19a9ee0>]}


============================== 04:11:59.669013 | d6fbb83a-5f07-4f0c-960d-6ed346fe1e58 ==============================
[0m04:11:59.669013 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:11:59.669446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:12:00.023696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff781a27b0>]}
[0m04:12:00.040805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73f54aa0>]}
[0m04:12:00.041124 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:12:00.079819 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:12:00.150654 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:12:00.150886 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:12:00.169139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73e478c0>]}
[0m04:12:00.216741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73c48f20>]}
[0m04:12:00.217023 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:12:00.217372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73e761e0>]}
[0m04:12:00.218053 [info ] [MainThread]: 
[0m04:12:00.218402 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:12:00.220275 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m04:12:00.225940 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m04:12:00.226117 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m04:12:00.226242 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:12:00.727994 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.502 seconds
[0m04:12:00.729262 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m04:12:00.844209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m04:12:00.851460 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:12:00.851805 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:12:00.852076 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:01.283657 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.431 seconds
[0m04:12:01.287360 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:12:01.411010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:12:01.414242 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:12:01.414586 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:12:01.414859 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:01.820345 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.405 seconds
[0m04:12:01.824060 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:12:01.951007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73bddd30>]}
[0m04:12:01.952424 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:12:01.954186 [info ] [MainThread]: 
[0m04:12:01.964492 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m04:12:01.965085 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m04:12:01.965665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m04:12:01.966039 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m04:12:01.972242 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:12:01.974673 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m04:12:01.990964 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:12:01.992238 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m04:12:01.992469 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m04:12:01.992707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:02.630892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.638 seconds
[0m04:12:02.641384 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m04:12:02.747100 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ef18d40>]}
[0m04:12:02.747689 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.78s]
[0m04:12:02.748403 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m04:12:02.749128 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m04:12:02.749534 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m04:12:02.749981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m04:12:02.750253 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m04:12:02.752503 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m04:12:02.754493 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m04:12:02.756121 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m04:12:02.758246 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m04:12:02.758642 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m04:12:02.759023 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:03.385728 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.627 seconds
[0m04:12:03.387457 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m04:12:03.518003 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff739a4f50>]}
[0m04:12:03.519690 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.77s]
[0m04:12:03.521816 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m04:12:03.523118 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:12:03.523841 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m04:12:03.524837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m04:12:03.525243 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:12:03.528423 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:12:03.531175 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:12:03.545554 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:12:03.547228 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m04:12:03.547574 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m04:12:03.547920 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:05.194970 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.647 seconds
[0m04:12:05.199139 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m04:12:05.324555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6fbb83a-5f07-4f0c-960d-6ed346fe1e58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72f3e750>]}
[0m04:12:05.325436 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.80s]
[0m04:12:05.326376 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m04:12:05.327827 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:12:05.328166 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m04:12:05.328593 [info ] [MainThread]: 
[0m04:12:05.329134 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.11 seconds (5.11s).
[0m04:12:05.329967 [debug] [MainThread]: Command end result
[0m04:12:05.361736 [info ] [MainThread]: 
[0m04:12:05.362205 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:12:05.362386 [info ] [MainThread]: 
[0m04:12:05.362658 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m04:12:05.363285 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.7303605, "process_user_time": 2.455759, "process_kernel_time": 0.108, "process_mem_max_rss": "211596", "process_in_blocks": "6800", "process_out_blocks": "2456"}
[0m04:12:05.363566 [debug] [MainThread]: Command `dbt run` succeeded at 04:12:05.363516 after 5.73 seconds
[0m04:12:05.363763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e8d51c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73ab3e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eb7dd00>]}
[0m04:12:05.363945 [debug] [MainThread]: Flushing usage events
[0m04:12:07.770700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d8a7e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f0209e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d8a53d0>]}


============================== 04:12:07.773701 | cb1cb25d-5578-44c8-bef3-0fef10506591 ==============================
[0m04:12:07.773701 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:12:07.774232 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m04:12:08.124080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eef6d80>]}
[0m04:12:08.141118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e82a4e0>]}
[0m04:12:08.141441 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:12:08.177887 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:12:08.245888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:12:08.246106 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:12:08.264021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72bc4500>]}
[0m04:12:08.315516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72ab7f50>]}
[0m04:12:08.315770 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:12:08.316127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72c03140>]}
[0m04:12:08.316888 [info ] [MainThread]: 
[0m04:12:08.317234 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:12:08.318911 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m04:12:08.325272 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:12:08.325451 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:12:08.325617 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:12:08.754949 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.429 seconds
[0m04:12:08.757064 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:12:08.876000 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:12:08.878928 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:12:08.879220 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:12:08.879489 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:09.328106 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.448 seconds
[0m04:12:09.331487 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:12:09.464872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb1cb25d-5578-44c8-bef3-0fef10506591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ed60380>]}
[0m04:12:09.466202 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:12:09.468180 [info ] [MainThread]: 
[0m04:12:09.478540 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:12:09.479081 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m04:12:09.479811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m04:12:09.480146 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:12:09.491637 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:12:09.493164 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:12:09.504799 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:12:09.506234 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m04:12:09.506540 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m04:12:09.506823 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:09.960573 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.454 seconds
[0m04:12:09.968908 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m04:12:10.104263 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.62s]
[0m04:12:10.105029 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m04:12:10.105397 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:12:10.105678 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m04:12:10.106083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m04:12:10.106308 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:12:10.108681 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:12:10.110726 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:12:10.111948 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:12:10.113124 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m04:12:10.113367 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m04:12:10.113647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:10.575639 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.462 seconds
[0m04:12:10.577383 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m04:12:10.702115 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.60s]
[0m04:12:10.703013 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m04:12:10.703512 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:12:10.703926 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m04:12:10.704378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m04:12:10.704660 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:12:10.707378 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:12:10.708833 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:12:10.710567 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:12:10.711899 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m04:12:10.712192 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m04:12:10.712484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:11.747116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.035 seconds
[0m04:12:11.748493 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m04:12:11.855258 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 1.15s]
[0m04:12:11.856047 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m04:12:11.856403 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:12:11.856729 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m04:12:11.857269 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m04:12:11.857638 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:12:11.860834 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:12:11.862848 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:12:11.864361 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:12:11.865373 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m04:12:11.865652 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m04:12:11.865903 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:12.772175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.906 seconds
[0m04:12:12.776434 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m04:12:12.914261 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 1.06s]
[0m04:12:12.914978 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m04:12:12.915953 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:12:12.916185 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m04:12:12.916405 [info ] [MainThread]: 
[0m04:12:12.916753 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m04:12:12.917310 [debug] [MainThread]: Command end result
[0m04:12:12.940321 [info ] [MainThread]: 
[0m04:12:12.940675 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:12:12.940830 [info ] [MainThread]: 
[0m04:12:12.941033 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m04:12:12.941458 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.225005, "process_user_time": 2.39219, "process_kernel_time": 0.108827, "process_mem_max_rss": "212732", "process_out_blocks": "2433", "process_in_blocks": "0"}
[0m04:12:12.941693 [debug] [MainThread]: Command `dbt test` succeeded at 04:12:12.941652 after 5.23 seconds
[0m04:12:12.941863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f0209e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dda5fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dda5b80>]}
[0m04:12:12.942019 [debug] [MainThread]: Flushing usage events
[0m04:12:14.735593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6a145f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6baf4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6bac6e0>]}


============================== 04:12:14.738503 | 727a48e3-d35d-4a2a-a834-97fe164e88da ==============================
[0m04:12:14.738503 [info ] [MainThread]: Running with dbt=1.8.7
[0m04:12:14.738953 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m04:12:15.064134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa594fbf0>]}
[0m04:12:15.081311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5e45b50>]}
[0m04:12:15.081636 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m04:12:15.119132 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m04:12:15.184264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m04:12:15.184486 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m04:12:15.202648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b9e12e0>]}
[0m04:12:15.250174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b7d6360>]}
[0m04:12:15.250425 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m04:12:15.250778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b6ffe00>]}
[0m04:12:15.251555 [info ] [MainThread]: 
[0m04:12:15.251895 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m04:12:15.252344 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m04:12:15.258099 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m04:12:15.258284 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m04:12:15.258441 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m04:12:15.593252 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.335 seconds
[0m04:12:15.594353 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m04:12:15.724677 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_SNAPSHOT)
[0m04:12:15.732294 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m04:12:15.732654 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m04:12:15.732929 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:16.138704 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.405 seconds
[0m04:12:16.142462 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m04:12:16.277405 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m04:12:16.280640 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m04:12:16.281181 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m04:12:16.281712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m04:12:16.660095 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.378 seconds
[0m04:12:16.661421 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m04:12:16.789960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b9e00b0>]}
[0m04:12:16.790721 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m04:12:16.791638 [info ] [MainThread]: 
[0m04:12:16.799618 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:12:16.800088 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m04:12:16.800650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m04:12:16.801018 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:12:16.813340 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:12:16.843209 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:16.843537 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m04:12:16.843770 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m04:12:17.787137 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.943 seconds
[0m04:12:17.791695 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:17.792208 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:12:17.879703 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.086 seconds
[0m04:12:17.884016 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:17.884267 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:12:17.975544 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.091 seconds
[0m04:12:18.000587 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:18.000998 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m04:12:19.324218 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.322 seconds
[0m04:12:19.329937 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.330487 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:12:19.419776 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.089 seconds
[0m04:12:19.426061 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.426734 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:12:19.493631 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.066 seconds
[0m04:12:19.499537 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.500183 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:12:19.580146 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.079 seconds
[0m04:12:19.584610 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.585110 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m04:12:19.676621 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.091 seconds
[0m04:12:19.687941 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.688615 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m04:12:19.773783 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.085 seconds
[0m04:12:19.783167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:19.783464 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m04:12:20.655471 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.871 seconds
[0m04:12:20.658182 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:20.658515 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m04:12:20.726502 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.068 seconds
[0m04:12:20.727033 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:20.729211 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:20.729449 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m04:12:20.882768 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.153 seconds
[0m04:12:20.883186 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:20.883438 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m04:12:21.784315 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.900 seconds
[0m04:12:21.785824 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m04:12:21.787189 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m04:12:22.190103 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m04:12:22.197999 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m04:12:22.664213 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '727a48e3-d35d-4a2a-a834-97fe164e88da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6a14d10>]}
[0m04:12:22.664748 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 5.86s]
[0m04:12:22.665139 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m04:12:22.665981 [debug] [MainThread]: Connection 'master' was properly closed.
[0m04:12:22.666161 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m04:12:22.666360 [info ] [MainThread]: 
[0m04:12:22.666736 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 7.41 seconds (7.41s).
[0m04:12:22.667175 [debug] [MainThread]: Command end result
[0m04:12:22.686312 [info ] [MainThread]: 
[0m04:12:22.686607 [info ] [MainThread]: [32mCompleted successfully[0m
[0m04:12:22.686752 [info ] [MainThread]: 
[0m04:12:22.686895 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m04:12:22.687367 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 7.9829683, "process_user_time": 2.449004, "process_kernel_time": 0.142524, "process_mem_max_rss": "212236", "process_out_blocks": "2448", "process_in_blocks": "0"}
[0m04:12:22.687581 [debug] [MainThread]: Command `dbt snapshot` succeeded at 04:12:22.687539 after 7.98 seconds
[0m04:12:22.687766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb664eba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b7ec770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b7ec5c0>]}
[0m04:12:22.687974 [debug] [MainThread]: Flushing usage events
[0m06:32:37.040965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb10ea690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2e07d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1d3e600>]}


============================== 06:32:37.044349 | fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27 ==============================
[0m06:32:37.044349 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:32:37.044675 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:32:37.484458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb25b26f0>]}
[0m06:32:37.501367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb12097c0>]}
[0m06:32:37.501763 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:32:37.542287 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:32:37.621177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:32:37.621401 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:32:37.638922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff865b0560>]}
[0m06:32:37.687699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86307d10>]}
[0m06:32:37.687951 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:32:37.688099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff862ad7c0>]}
[0m06:32:37.688808 [info ] [MainThread]: 
[0m06:32:37.689066 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:32:37.691192 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:32:37.697022 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:32:37.697203 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:32:37.697323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:32:38.198317 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.501 seconds
[0m06:32:38.199965 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:32:38.319470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m06:32:38.328074 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:32:38.328462 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:32:38.328851 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:32:38.780942 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.452 seconds
[0m06:32:38.785079 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:32:38.911748 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:32:38.915348 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:32:38.915834 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:32:38.916233 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:32:39.286942 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.371 seconds
[0m06:32:39.287932 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:32:39.396407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb229a030>]}
[0m06:32:39.396812 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:32:39.397007 [info ] [MainThread]: 
[0m06:32:39.401693 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:32:39.401992 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m06:32:39.402238 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m06:32:39.402446 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m06:32:39.405539 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:32:39.406636 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m06:32:39.416898 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:32:39.418314 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:32:39.418561 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m06:32:39.418767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:40.041527 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.622 seconds
[0m06:32:40.050746 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m06:32:40.211574 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8688de50>]}
[0m06:32:40.212064 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.81s]
[0m06:32:40.212416 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:32:40.212906 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m06:32:40.213165 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m06:32:40.213482 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m06:32:40.213629 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m06:32:40.215045 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:32:40.215877 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m06:32:40.216986 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:32:40.218382 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m06:32:40.218572 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m06:32:40.218774 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:41.066460 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.848 seconds
[0m06:32:41.068634 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m06:32:41.208576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8578ddc0>]}
[0m06:32:41.210718 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.99s]
[0m06:32:41.212256 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m06:32:41.213431 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:32:41.214057 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m06:32:41.214932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m06:32:41.215329 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:32:41.218480 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:32:41.221213 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:32:41.235451 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:32:41.236984 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:32:41.237310 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m06:32:41.237576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:43.015487 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.778 seconds
[0m06:32:43.020196 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m06:32:43.133509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe7bc3f4-06ef-42e3-8d0b-bc58a853ef27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff857c9190>]}
[0m06:32:43.134158 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.92s]
[0m06:32:43.134964 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:32:43.136085 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:32:43.136387 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m06:32:43.136706 [info ] [MainThread]: 
[0m06:32:43.137026 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.45 seconds (5.45s).
[0m06:32:43.137809 [debug] [MainThread]: Command end result
[0m06:32:43.161883 [info ] [MainThread]: 
[0m06:32:43.162278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:32:43.162559 [info ] [MainThread]: 
[0m06:32:43.162842 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m06:32:43.163799 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.1584682, "process_user_time": 2.430797, "process_kernel_time": 0.182359, "process_mem_max_rss": "211440", "process_in_blocks": "93408", "process_out_blocks": "2456"}
[0m06:32:43.164080 [debug] [MainThread]: Command `dbt run` succeeded at 06:32:43.164030 after 6.16 seconds
[0m06:32:43.164276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb10ea690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff866c6c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0b6b7a0>]}
[0m06:32:43.164459 [debug] [MainThread]: Flushing usage events
[0m06:32:44.945871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e0fd280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8da9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e0fd3d0>]}


============================== 06:32:44.948699 | 33e7232e-9f5e-4eb4-bbc6-b079444c0b39 ==============================
[0m06:32:44.948699 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:32:44.949132 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:32:45.282124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e70f8c0>]}
[0m06:32:45.298578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72baf470>]}
[0m06:32:45.298907 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:32:45.334600 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:32:45.401977 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:32:45.402240 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:32:45.419476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a76e120>]}
[0m06:32:45.469604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5367e8a0>]}
[0m06:32:45.469912 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:32:45.470259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff533cfda0>]}
[0m06:32:45.471136 [info ] [MainThread]: 
[0m06:32:45.471518 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:32:45.473313 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m06:32:45.479663 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:32:45.479849 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:32:45.479994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:32:45.921285 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.441 seconds
[0m06:32:45.923887 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:32:46.072391 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:32:46.076240 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:32:46.076711 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:32:46.077073 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:32:46.446916 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.370 seconds
[0m06:32:46.449449 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:32:46.581237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33e7232e-9f5e-4eb4-bbc6-b079444c0b39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f59bfe0>]}
[0m06:32:46.582416 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:32:46.583478 [info ] [MainThread]: 
[0m06:32:46.594520 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:32:46.595131 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m06:32:46.595944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m06:32:46.596487 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:32:46.608268 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:32:46.610503 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:32:46.622647 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:32:46.624032 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:32:46.624271 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m06:32:46.624588 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:47.140505 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.516 seconds
[0m06:32:47.151782 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m06:32:47.268920 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.67s]
[0m06:32:47.271189 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:32:47.272337 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:32:47.273176 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m06:32:47.274156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m06:32:47.274633 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:32:47.279088 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:32:47.281717 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:32:47.283643 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:32:47.285817 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:32:47.286254 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m06:32:47.286620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:47.762819 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.476 seconds
[0m06:32:47.765190 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m06:32:47.895637 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.62s]
[0m06:32:47.899605 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:32:47.900511 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:32:47.901170 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m06:32:47.902128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m06:32:47.902576 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:32:47.907549 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:32:47.910208 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:32:47.912307 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:32:47.913693 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:32:47.914092 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m06:32:47.914449 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:48.852530 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m06:32:48.854885 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m06:32:48.999200 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 1.10s]
[0m06:32:49.000745 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:32:49.001310 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:32:49.001767 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m06:32:49.002633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m06:32:49.003171 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:32:49.007532 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:32:49.011191 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:32:49.013259 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:32:49.014681 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:32:49.015001 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m06:32:49.015358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:50.490845 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.475 seconds
[0m06:32:50.495096 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m06:32:50.636494 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 1.63s]
[0m06:32:50.637440 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:32:50.638875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:32:50.639223 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m06:32:50.639512 [info ] [MainThread]: 
[0m06:32:50.639888 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 5.17 seconds (5.17s).
[0m06:32:50.640617 [debug] [MainThread]: Command end result
[0m06:32:50.667576 [info ] [MainThread]: 
[0m06:32:50.668033 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:32:50.668215 [info ] [MainThread]: 
[0m06:32:50.668416 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:32:50.668881 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.753948, "process_user_time": 2.413747, "process_kernel_time": 0.125506, "process_mem_max_rss": "212604", "process_in_blocks": "1152", "process_out_blocks": "2433"}
[0m06:32:50.669133 [debug] [MainThread]: Command `dbt test` succeeded at 06:32:50.669089 after 5.75 seconds
[0m06:32:50.669321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8da9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e0b6ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff53c91b20>]}
[0m06:32:50.669492 [debug] [MainThread]: Flushing usage events
[0m06:32:52.896157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f251eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f567350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb1f170>]}


============================== 06:32:52.898938 | 55a6e131-7e89-4756-b1bc-4a5de49a9f67 ==============================
[0m06:32:52.898938 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:32:52.899362 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:32:53.218279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f3a2e10>]}
[0m06:32:53.234906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6629e5a0>]}
[0m06:32:53.235230 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:32:53.271775 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:32:53.337347 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:32:53.337578 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:32:53.355206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65e5e090>]}
[0m06:32:53.401590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65e80bf0>]}
[0m06:32:53.401836 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:32:53.402193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff66c56060>]}
[0m06:32:53.402842 [info ] [MainThread]: 
[0m06:32:53.403175 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:32:53.403609 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:32:53.409357 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:32:53.409525 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:32:53.409663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:32:53.855395 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.446 seconds
[0m06:32:53.856268 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:32:53.962335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:32:53.967868 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:32:53.968286 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:32:53.968559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:32:54.376362 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.407 seconds
[0m06:32:54.380127 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:32:54.520479 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m06:32:54.524073 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:32:54.524486 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:32:54.524831 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:32:54.910885 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.386 seconds
[0m06:32:54.914739 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:32:55.066426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d6742c0>]}
[0m06:32:55.067004 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:32:55.067683 [info ] [MainThread]: 
[0m06:32:55.074594 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:32:55.074989 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m06:32:55.075471 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m06:32:55.075796 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:32:55.087067 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:32:55.115700 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:55.116037 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:32:55.116255 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:32:56.223129 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.107 seconds
[0m06:32:56.234615 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:56.235676 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:32:56.350771 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.114 seconds
[0m06:32:56.362027 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:56.362632 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:32:56.466200 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.103 seconds
[0m06:32:56.499831 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:56.500319 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:32:58.134166 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.633 seconds
[0m06:32:58.140430 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.141207 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:32:58.217412 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.076 seconds
[0m06:32:58.220786 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.221167 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:32:58.306776 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.085 seconds
[0m06:32:58.312391 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.312961 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:32:58.403514 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.090 seconds
[0m06:32:58.409790 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.410322 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:32:58.530214 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.119 seconds
[0m06:32:58.534587 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.534910 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:32:58.664076 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.129 seconds
[0m06:32:58.672965 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:58.673295 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m06:32:59.309834 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.636 seconds
[0m06:32:59.311521 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:59.311714 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m06:32:59.394657 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.083 seconds
[0m06:32:59.395098 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:59.396591 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:59.396813 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m06:32:59.483085 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m06:32:59.483394 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:32:59.483605 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:33:00.215829 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.732 seconds
[0m06:33:00.216604 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:33:00.216934 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m06:33:00.525723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.308 seconds
[0m06:33:00.546796 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m06:33:00.670673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55a6e131-7e89-4756-b1bc-4a5de49a9f67', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cebcfb0>]}
[0m06:33:00.671480 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 6[0m in 5.59s]
[0m06:33:00.672257 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:33:00.673526 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:33:00.673826 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m06:33:00.674197 [info ] [MainThread]: 
[0m06:33:00.674613 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 7.27 seconds (7.27s).
[0m06:33:00.675128 [debug] [MainThread]: Command end result
[0m06:33:00.701971 [info ] [MainThread]: 
[0m06:33:00.702407 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:33:00.702579 [info ] [MainThread]: 
[0m06:33:00.702760 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:33:00.703226 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 7.837408, "process_user_time": 2.448718, "process_kernel_time": 0.119741, "process_mem_max_rss": "210184", "process_in_blocks": "8", "process_out_blocks": "2448"}
[0m06:33:00.703461 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:33:00.703417 after 7.84 seconds
[0m06:33:00.703636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90e0aa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db68890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb5a840>]}
[0m06:33:00.703800 [debug] [MainThread]: Flushing usage events
[0m06:37:48.309117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6422b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb89273e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8925ac0>]}


============================== 06:37:48.312224 | cbe57f20-66ed-496b-90b7-1191d4b6c100 ==============================
[0m06:37:48.312224 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:37:48.312642 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:37:48.656800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ba0a180>]}
[0m06:37:48.675632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b561580>]}
[0m06:37:48.676139 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:37:48.716252 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:37:48.782366 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:37:48.782648 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:37:48.802766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b2753d0>]}
[0m06:37:48.852576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b0141d0>]}
[0m06:37:48.852865 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:37:48.853064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b610f50>]}
[0m06:37:48.853981 [info ] [MainThread]: 
[0m06:37:48.854308 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:37:48.856432 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:37:48.862648 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:37:48.862874 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:37:48.863009 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:37:49.294088 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.431 seconds
[0m06:37:49.295145 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:37:49.402664 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m06:37:49.406421 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:37:49.406665 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:37:49.406840 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:37:49.809941 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.403 seconds
[0m06:37:49.811122 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:37:49.928922 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:37:49.930895 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:37:49.931145 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:37:49.931316 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:37:50.352410 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.421 seconds
[0m06:37:50.353680 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:37:50.480413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7100260>]}
[0m06:37:50.481189 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:37:50.481803 [info ] [MainThread]: 
[0m06:37:50.490883 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:37:50.491441 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m06:37:50.491910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m06:37:50.492235 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m06:37:50.497912 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:37:50.499125 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m06:37:50.515736 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:37:50.517041 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:37:50.517315 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m06:37:50.517541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:51.068068 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.550 seconds
[0m06:37:51.087741 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m06:37:51.209695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6288dd0>]}
[0m06:37:51.210619 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.72s]
[0m06:37:51.211431 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:37:51.212337 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m06:37:51.212874 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m06:37:51.213352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m06:37:51.213697 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m06:37:51.216753 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:37:51.217954 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m06:37:51.220129 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:37:51.222540 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m06:37:51.222882 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m06:37:51.223226 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:51.715954 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.493 seconds
[0m06:37:51.717049 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m06:37:51.841053 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a37ecc0>]}
[0m06:37:51.841483 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 0.63s]
[0m06:37:51.841861 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m06:37:51.842296 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:37:51.842549 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m06:37:51.842783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m06:37:51.842972 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:37:51.844374 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:37:51.845099 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:37:51.852806 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:37:51.853795 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:37:51.854016 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m06:37:51.854189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:53.275995 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.421 seconds
[0m06:37:53.280479 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m06:37:53.449453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe57f20-66ed-496b-90b7-1191d4b6c100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a358da0>]}
[0m06:37:53.450510 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.61s]
[0m06:37:53.451425 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:37:53.453034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:37:53.453396 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m06:37:53.453881 [info ] [MainThread]: 
[0m06:37:53.454301 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m06:37:53.455706 [debug] [MainThread]: Command end result
[0m06:37:53.487054 [info ] [MainThread]: 
[0m06:37:53.487385 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:37:53.487549 [info ] [MainThread]: 
[0m06:37:53.487719 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m06:37:53.488283 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.211881, "process_user_time": 2.361326, "process_kernel_time": 0.116114, "process_mem_max_rss": "211596", "process_out_blocks": "2456", "process_in_blocks": "0"}
[0m06:37:53.488549 [debug] [MainThread]: Command `dbt run` succeeded at 06:37:53.488500 after 5.21 seconds
[0m06:37:53.488753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8925ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5eedbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5eed1f0>]}
[0m06:37:53.488959 [debug] [MainThread]: Flushing usage events
[0m06:37:55.226547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96c5b050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96e5ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97170320>]}


============================== 06:37:55.229388 | e105bfa3-5960-445e-9566-be7009328eab ==============================
[0m06:37:55.229388 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:37:55.229812 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:37:55.548676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86984770>]}
[0m06:37:55.565375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95392f00>]}
[0m06:37:55.565713 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:37:55.601861 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:37:55.669118 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:37:55.669328 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:37:55.686768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b267440>]}
[0m06:37:55.737516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6aea23f0>]}
[0m06:37:55.737782 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:37:55.738136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b392b40>]}
[0m06:37:55.738862 [info ] [MainThread]: 
[0m06:37:55.739193 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:37:55.740901 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_analytics'
[0m06:37:55.747363 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:37:55.747540 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:37:55.747710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:37:56.200197 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.452 seconds
[0m06:37:56.202530 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:37:56.335651 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:37:56.341633 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:37:56.342415 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:37:56.343046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:37:56.733765 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.391 seconds
[0m06:37:56.736186 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:37:56.879385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e105bfa3-5960-445e-9566-be7009328eab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97190170>]}
[0m06:37:56.880773 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:37:56.882910 [info ] [MainThread]: 
[0m06:37:56.894159 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:37:56.894721 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m06:37:56.895526 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m06:37:56.895884 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:37:56.907318 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:37:56.908721 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:37:56.920296 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:37:56.921414 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:37:56.921659 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m06:37:56.921891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:57.520710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.599 seconds
[0m06:37:57.527629 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m06:37:57.676798 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.78s]
[0m06:37:57.677563 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:37:57.677923 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:37:57.678207 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m06:37:57.678655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m06:37:57.678941 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:37:57.681616 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:37:57.682564 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:37:57.683944 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:37:57.684829 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:37:57.685135 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m06:37:57.685372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:58.095291 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.410 seconds
[0m06:37:58.096755 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m06:37:58.234199 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.56s]
[0m06:37:58.235326 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:37:58.235806 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:37:58.236289 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m06:37:58.236942 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m06:37:58.237289 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:37:58.240888 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:37:58.242020 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:37:58.243620 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:37:58.244661 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:37:58.244999 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m06:37:58.245272 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:58.754567 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.509 seconds
[0m06:37:58.760133 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m06:37:58.895722 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 0.66s]
[0m06:37:58.897292 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:37:58.897981 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:37:58.898474 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m06:37:58.899281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m06:37:58.899653 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:37:58.904179 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:37:58.905584 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:37:58.907429 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:37:58.908654 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:37:58.908980 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m06:37:58.909285 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:37:59.517355 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.608 seconds
[0m06:37:59.518836 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m06:37:59.621509 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 0.72s]
[0m06:37:59.622483 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:37:59.623881 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:37:59.624221 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m06:37:59.624532 [info ] [MainThread]: 
[0m06:37:59.624994 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m06:37:59.625757 [debug] [MainThread]: Command end result
[0m06:37:59.652279 [info ] [MainThread]: 
[0m06:37:59.652675 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:37:59.652826 [info ] [MainThread]: 
[0m06:37:59.652997 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:37:59.653536 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.4591765, "process_user_time": 2.400364, "process_kernel_time": 0.114207, "process_mem_max_rss": "212476", "process_out_blocks": "2433", "process_in_blocks": "0"}
[0m06:37:59.653777 [debug] [MainThread]: Command `dbt test` succeeded at 06:37:59.653733 after 4.46 seconds
[0m06:37:59.653996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95c4d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95c89dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a3f4680>]}
[0m06:37:59.654235 [debug] [MainThread]: Flushing usage events
[0m06:38:01.282981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f53e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8404e870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8404ef30>]}


============================== 06:38:01.285733 | 2fde48de-e91d-41cf-98d3-7565e8afd10a ==============================
[0m06:38:01.285733 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:38:01.286169 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:38:01.599445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d6a5640>]}
[0m06:38:01.615891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d98bb90>]}
[0m06:38:01.616241 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:38:01.652960 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:38:01.719529 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:38:01.719760 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:38:01.737412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d52eba0>]}
[0m06:38:01.783495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d28f290>]}
[0m06:38:01.783740 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:38:01.784078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d27b4d0>]}
[0m06:38:01.784730 [info ] [MainThread]: 
[0m06:38:01.785087 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:38:01.785507 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:38:01.791147 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:38:01.791324 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:38:01.791465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:38:02.222745 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.431 seconds
[0m06:38:02.223756 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:38:02.341106 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:38:02.347991 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:38:02.348321 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:38:02.348629 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:38:02.748142 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.399 seconds
[0m06:38:02.751758 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:38:02.898385 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m06:38:02.901013 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:38:02.901352 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:38:02.901631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:38:03.250762 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.349 seconds
[0m06:38:03.253031 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:38:03.368261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80572210>]}
[0m06:38:03.369596 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:38:03.371345 [info ] [MainThread]: 
[0m06:38:03.381822 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:38:03.382480 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m06:38:03.383103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m06:38:03.383451 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:38:03.396859 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:38:03.427584 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:03.427917 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:38:03.428193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:38:03.823392 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.395 seconds
[0m06:38:03.835766 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:03.836613 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:38:03.944464 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.107 seconds
[0m06:38:03.954391 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:03.954954 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:38:04.037451 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.082 seconds
[0m06:38:04.070515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:04.071060 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:38:05.149800 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.078 seconds
[0m06:38:05.152383 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.152739 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:38:05.260944 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.108 seconds
[0m06:38:05.266424 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.267061 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:38:05.341799 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.074 seconds
[0m06:38:05.348349 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.349089 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:38:05.432704 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.083 seconds
[0m06:38:05.435616 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.435963 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:38:05.519807 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.084 seconds
[0m06:38:05.524303 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.524539 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:38:05.602442 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.078 seconds
[0m06:38:05.612922 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.613253 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m06:38:05.973688 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.359 seconds
[0m06:38:05.979146 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:05.980032 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m06:38:06.082173 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.102 seconds
[0m06:38:06.083231 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:06.085527 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:06.086009 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m06:38:06.221244 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m06:38:06.222615 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:06.223492 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:38:06.758763 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.534 seconds
[0m06:38:06.759965 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:38:06.760560 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m06:38:07.101245 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.340 seconds
[0m06:38:07.121941 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m06:38:07.271559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fde48de-e91d-41cf-98d3-7565e8afd10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d87d6d0>]}
[0m06:38:07.272308 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 3.89s]
[0m06:38:07.273055 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:38:07.274348 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:38:07.274683 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m06:38:07.274960 [info ] [MainThread]: 
[0m06:38:07.275216 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.49 seconds (5.49s).
[0m06:38:07.275880 [debug] [MainThread]: Command end result
[0m06:38:07.300453 [info ] [MainThread]: 
[0m06:38:07.300855 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:38:07.301017 [info ] [MainThread]: 
[0m06:38:07.301211 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:38:07.301664 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.04911, "process_user_time": 2.462348, "process_kernel_time": 0.100014, "process_mem_max_rss": "212228", "process_out_blocks": "2448", "process_in_blocks": "0"}
[0m06:38:07.301984 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:38:07.301920 after 6.05 seconds
[0m06:38:07.302196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f511c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b5ede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b5f050>]}
[0m06:38:07.302368 [debug] [MainThread]: Flushing usage events
[0m06:42:42.350625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf6b8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf25f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0f27c80>]}


============================== 06:42:42.353872 | 774bb1a2-5480-4f49-aba8-f6b18ba5f627 ==============================
[0m06:42:42.353872 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:42:42.354338 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:42:42.709781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88c657c0>]}
[0m06:42:42.729228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0510440>]}
[0m06:42:42.731647 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:42:42.774556 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:42:42.839241 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:42:42.839489 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:42:42.857050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff883b7f50>]}
[0m06:42:42.899948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884ab650>]}
[0m06:42:42.900189 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:42:42.900352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabf3da90>]}
[0m06:42:42.901098 [info ] [MainThread]: 
[0m06:42:42.901450 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:42:42.903361 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:42:42.908794 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:42:42.908946 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:42:42.909113 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:42:43.406516 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.497 seconds
[0m06:42:43.408082 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:42:43.580645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_analytics)
[0m06:42:43.591770 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:42:43.592528 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:42:43.592986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:42:44.071813 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.479 seconds
[0m06:42:44.075828 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:42:44.199142 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:42:44.204582 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:42:44.205122 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:42:44.205534 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:42:44.641298 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.435 seconds
[0m06:42:44.645106 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:42:44.770561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb05300b0>]}
[0m06:42:44.771790 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:42:44.772993 [info ] [MainThread]: 
[0m06:42:44.782689 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:42:44.783223 [info ] [Thread-1 (]: 1 of 3 START sql view model analytics.stg_stock_price .......................... [RUN]
[0m06:42:44.783818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now model.azm_meta_stock_analytics.stg_stock_price)
[0m06:42:44.784146 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stg_stock_price
[0m06:42:44.790060 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:42:44.791185 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stg_stock_price
[0m06:42:44.809625 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:42:44.810955 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stg_stock_price"
[0m06:42:44.811234 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stg_stock_price"} */
create or replace   view USER_DB_KOALA.analytics.stg_stock_price
  
   as (
    with source as (
    select
        symbol,
        date,
        open,
        high,
        low,
        close,
        volume
    from USER_DB_KOALA.RAW.stock_price_amazon_meta
),

cleaned_data as (
    select
        upper(trim(symbol)) as symbol,    
        try_to_date(date) as date,    
        try_to_number(open, 12, 4) as open,
        try_to_number(high, 12, 4) as high,
        try_to_number(low, 12, 4) as low,
        try_to_number(close, 12, 4) as close,
        try_to_number(volume, 38, 0) as volume
    from source
    where symbol is not null
      and date is not null
      and close is not null
      and volume >= 0
)

select
    symbol,
    date,
    open,
    high,
    low,
    close,
    volume
from cleaned_data
  );
[0m06:42:44.811558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:45.384635 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.573 seconds
[0m06:42:45.405587 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stg_stock_price: Close
[0m06:42:45.544754 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf6b8dd0>]}
[0m06:42:45.546125 [info ] [Thread-1 (]: 1 of 3 OK created sql view model analytics.stg_stock_price ..................... [[32mSUCCESS 1[0m in 0.76s]
[0m06:42:45.547060 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stg_stock_price
[0m06:42:45.548119 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_transformations
[0m06:42:45.548830 [info ] [Thread-1 (]: 2 of 3 START sql view model analytics.stock_transformations .................... [RUN]
[0m06:42:45.549657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stg_stock_price, now model.azm_meta_stock_analytics.stock_transformations)
[0m06:42:45.550004 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_transformations
[0m06:42:45.553024 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:42:45.554368 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_transformations
[0m06:42:45.556652 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_transformations"
[0m06:42:45.558983 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_transformations"
[0m06:42:45.559352 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_transformations"} */
create or replace   view USER_DB_KOALA.analytics.stock_transformations
  
   as (
    with cleanData as (
  select *
  from USER_DB_KOALA.analytics.stg_stock_price
),

tech_features as (
  select
    symbol,
    date,
    close,
    volume,

    -- Calculating Simple Moving Averages
    avg(close) over (
      partition by symbol order by date
      rows between 19 preceding and current row
    ) as sma_20,

    avg(close) over (
      partition by symbol order by date
      rows between 49 preceding and current row
    ) as sma_50,

    avg(close) over (
      partition by symbol order by date
      rows between 199 preceding and current row
    ) as sma_200,

    -- Calculating 10 day momentum
    (close - lag(close, 10) over (
      partition by symbol order by date
    )) as momentum_10
  from cleanData
),

day_diffs as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    close - lag(close) over (
      partition by symbol order by date
    ) as chg
  from tech_features
),

gain_loss as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    iff(chg > 0, chg, 0)        as gain,
    iff(chg < 0, -chg, 0)       as loss
  from day_diffs
),

rolling_avg as (
  -- Calculating Rolling averages 14 days
  select
    symbol,
    date,
    close,
    volume,
    sma_20, sma_50, sma_200, momentum_10,
    avg(gain) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_gain,
    avg(loss) over (
      partition by symbol order by date
      rows between 13 preceding and current row
    ) as avg_loss
  from gain_loss
),

final_output as (
  select
    symbol,
    date,
    close,
    volume,
    sma_20,
    sma_50,
    sma_200,
    momentum_10,
    case
      when avg_gain is null and avg_loss is null then null
      when coalesce(avg_loss, 0) = 0 and coalesce(avg_gain, 0) > 0 then 100
      when coalesce(avg_gain, 0) = 0 and coalesce(avg_loss, 0) > 0 then 0
      when coalesce(avg_loss, 0) = 0 then null
      else 100 - 100 / (1 + (avg_gain / avg_loss))
    end as rsi_14
  from rolling_avg
)


select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14
from final_output
  );
[0m06:42:45.559690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:46.430750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.871 seconds
[0m06:42:46.435217 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_transformations: Close
[0m06:42:46.551058 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f63aa0>]}
[0m06:42:46.552025 [info ] [Thread-1 (]: 2 of 3 OK created sql view model analytics.stock_transformations ............... [[32mSUCCESS 1[0m in 1.00s]
[0m06:42:46.553111 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_transformations
[0m06:42:46.553881 [debug] [Thread-1 (]: Began running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:42:46.554404 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.stock_price_technical_indicators ........ [RUN]
[0m06:42:46.555160 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.azm_meta_stock_analytics.stock_transformations, now model.azm_meta_stock_analytics.stock_price_technical_indicators)
[0m06:42:46.555538 [debug] [Thread-1 (]: Began compiling node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:42:46.558312 [debug] [Thread-1 (]: Writing injected SQL for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:42:46.559445 [debug] [Thread-1 (]: Began executing node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:42:46.573514 [debug] [Thread-1 (]: Writing runtime sql for node "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:42:46.574943 [debug] [Thread-1 (]: Using snowflake connection "model.azm_meta_stock_analytics.stock_price_technical_indicators"
[0m06:42:46.575209 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "model.azm_meta_stock_analytics.stock_price_technical_indicators"} */
create or replace transient table USER_DB_KOALA.analytics.stock_price_technical_indicators
         as
        (select
  symbol,
  date,
  close,
  volume,
  sma_20,
  sma_50,
  sma_200,
  momentum_10,
  rsi_14,

  case 
    when sma_20 > sma_50 then 'Bullish'
    else 'Bearish'
  end as regime_20_50,

  case
    when rsi_14 > 70 then 'Overbought'
    when rsi_14 < 30 then 'Oversold'
    else 'Neutral'
  end as rsi_signal,

  case
    when momentum_10 > 0 then 'Uptrend'
    when momentum_10 < 0 then 'Downtrend'
    else 'No Change'
  end as momentum_signal,

  case
    when rsi_14 < 30 and momentum_10 > 0 then 'BUY'      
    when rsi_14 > 70 and momentum_10 < 0 then 'SELL'     
    else 'HOLD'
  end as trade_signal

from USER_DB_KOALA.analytics.stock_transformations
        );
[0m06:42:46.575496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:48.174857 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.599 seconds
[0m06:42:48.178893 [debug] [Thread-1 (]: On model.azm_meta_stock_analytics.stock_price_technical_indicators: Close
[0m06:42:48.295028 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '774bb1a2-5480-4f49-aba8-f6b18ba5f627', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f60530>]}
[0m06:42:48.296578 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.stock_price_technical_indicators ... [[32mSUCCESS 1[0m in 1.74s]
[0m06:42:48.298366 [debug] [Thread-1 (]: Finished running node model.azm_meta_stock_analytics.stock_price_technical_indicators
[0m06:42:48.300997 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:42:48.301695 [debug] [MainThread]: Connection 'model.azm_meta_stock_analytics.stock_price_technical_indicators' was properly closed.
[0m06:42:48.302182 [info ] [MainThread]: 
[0m06:42:48.302680 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 5.40 seconds (5.40s).
[0m06:42:48.303841 [debug] [MainThread]: Command end result
[0m06:42:48.335731 [info ] [MainThread]: 
[0m06:42:48.336226 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:42:48.336539 [info ] [MainThread]: 
[0m06:42:48.336858 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m06:42:48.337536 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.028594, "process_user_time": 2.527336, "process_kernel_time": 0.150079, "process_mem_max_rss": "211472", "process_out_blocks": "2456", "process_in_blocks": "0"}
[0m06:42:48.337788 [debug] [MainThread]: Command `dbt run` succeeded at 06:42:48.337738 after 6.03 seconds
[0m06:42:48.337973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaefed490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf31dd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf31d370>]}
[0m06:42:48.338163 [debug] [MainThread]: Flushing usage events
[0m06:42:50.294172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb12141d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1216330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb185c860>]}


============================== 06:42:50.296973 | 28bcc303-997f-45d1-b9e6-02d5365dc068 ==============================
[0m06:42:50.296973 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:42:50.297409 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:42:50.612986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8afb6000>]}
[0m06:42:50.629563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a9a70e0>]}
[0m06:42:50.629900 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:42:50.665437 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:42:50.735440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:42:50.735679 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:42:50.755284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a1e38c0>]}
[0m06:42:50.807450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89e1e480>]}
[0m06:42:50.807707 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:42:50.808039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a211310>]}
[0m06:42:50.808914 [info ] [MainThread]: 
[0m06:42:50.809307 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:42:50.811032 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA_SNAPSHOT'
[0m06:42:50.817242 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:42:50.817417 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:42:50.817595 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:42:51.270095 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.452 seconds
[0m06:42:51.272066 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:42:51.417464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m06:42:51.421403 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:42:51.421840 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:42:51.422190 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:42:51.824192 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.402 seconds
[0m06:42:51.828001 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:42:51.970010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28bcc303-997f-45d1-b9e6-02d5365dc068', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a1b3470>]}
[0m06:42:51.970971 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:42:51.972105 [info ] [MainThread]: 
[0m06:42:51.981281 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:42:51.981756 [info ] [Thread-1 (]: 1 of 4 START test not_null_stock_price_technical_indicators_date ............... [RUN]
[0m06:42:51.982335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b)
[0m06:42:51.982699 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:42:51.993513 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:42:51.994614 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:42:52.005638 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:42:52.006884 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"
[0m06:42:52.007240 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where date is null



      
    ) dbt_internal_test
[0m06:42:52.007523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:52.470225 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.462 seconds
[0m06:42:52.480802 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b: Close
[0m06:42:52.595032 [info ] [Thread-1 (]: 1 of 4 PASS not_null_stock_price_technical_indicators_date ..................... [[32mPASS[0m in 0.61s]
[0m06:42:52.596973 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b
[0m06:42:52.597710 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:42:52.598315 [info ] [Thread-1 (]: 2 of 4 START test not_null_stock_price_technical_indicators_symbol ............. [RUN]
[0m06:42:52.599193 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_date.1e55e3c47b, now test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e)
[0m06:42:52.600173 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:42:52.605604 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:42:52.607400 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:42:52.609598 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:42:52.610951 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"
[0m06:42:52.611386 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_price_technical_indicators
where symbol is null



      
    ) dbt_internal_test
[0m06:42:52.611738 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:53.056579 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.445 seconds
[0m06:42:53.058692 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e: Close
[0m06:42:53.171756 [info ] [Thread-1 (]: 2 of 4 PASS not_null_stock_price_technical_indicators_symbol ................... [[32mPASS[0m in 0.57s]
[0m06:42:53.172676 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e
[0m06:42:53.173065 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:42:53.173388 [info ] [Thread-1 (]: 3 of 4 START test not_null_stock_transformations_date .......................... [RUN]
[0m06:42:53.173892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_price_technical_indicators_symbol.ca93103c7e, now test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed)
[0m06:42:53.174171 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:42:53.177175 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:42:53.178243 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:42:53.179836 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:42:53.180839 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"
[0m06:42:53.181118 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_KOALA.analytics.stock_transformations
where date is null



      
    ) dbt_internal_test
[0m06:42:53.181388 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:54.060858 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.879 seconds
[0m06:42:54.064840 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed: Close
[0m06:42:54.225823 [info ] [Thread-1 (]: 3 of 4 PASS not_null_stock_transformations_date ................................ [[32mPASS[0m in 1.05s]
[0m06:42:54.227712 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed
[0m06:42:54.228845 [debug] [Thread-1 (]: Began running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:42:54.229800 [info ] [Thread-1 (]: 4 of 4 START test not_null_stock_transformations_symbol ........................ [RUN]
[0m06:42:54.230819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.azm_meta_stock_analytics.not_null_stock_transformations_date.e8735749ed, now test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4)
[0m06:42:54.231297 [debug] [Thread-1 (]: Began compiling node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:42:54.235913 [debug] [Thread-1 (]: Writing injected SQL for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:42:54.237474 [debug] [Thread-1 (]: Began executing node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:42:54.239433 [debug] [Thread-1 (]: Writing runtime sql for node "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:42:54.240849 [debug] [Thread-1 (]: Using snowflake connection "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"
[0m06:42:54.241270 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_KOALA.analytics.stock_transformations
where symbol is null



      
    ) dbt_internal_test
[0m06:42:54.241687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:42:55.233480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.992 seconds
[0m06:42:55.234884 [debug] [Thread-1 (]: On test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4: Close
[0m06:42:55.352908 [info ] [Thread-1 (]: 4 of 4 PASS not_null_stock_transformations_symbol .............................. [[32mPASS[0m in 1.12s]
[0m06:42:55.353934 [debug] [Thread-1 (]: Finished running node test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4
[0m06:42:55.355656 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:42:55.356061 [debug] [MainThread]: Connection 'test.azm_meta_stock_analytics.not_null_stock_transformations_symbol.320d6e4cb4' was properly closed.
[0m06:42:55.356477 [info ] [MainThread]: 
[0m06:42:55.357068 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 4.55 seconds (4.55s).
[0m06:42:55.358052 [debug] [MainThread]: Command end result
[0m06:42:55.387789 [info ] [MainThread]: 
[0m06:42:55.388295 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:42:55.388516 [info ] [MainThread]: 
[0m06:42:55.388717 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:42:55.389212 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.125259, "process_user_time": 2.389602, "process_kernel_time": 0.108664, "process_mem_max_rss": "212528", "process_out_blocks": "2433", "process_in_blocks": "0"}
[0m06:42:55.389491 [debug] [MainThread]: Command `dbt test` succeeded at 06:42:55.389444 after 5.13 seconds
[0m06:42:55.389690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb142cf80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a5a1f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0e79190>]}
[0m06:42:55.389873 [debug] [MainThread]: Flushing usage events
[0m06:42:57.236928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84749100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83ee51f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e3bcb0>]}


============================== 06:42:57.239729 | 4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd ==============================
[0m06:42:57.239729 [info ] [MainThread]: Running with dbt=1.8.7
[0m06:42:57.240161 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:42:57.555375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5da4ea80>]}
[0m06:42:57.571893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d8a8560>]}
[0m06:42:57.572210 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:42:57.608784 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m06:42:57.674970 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:42:57.675190 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:42:57.692462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d574f50>]}
[0m06:42:57.739254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d8aa6c0>]}
[0m06:42:57.739519 [info ] [MainThread]: Found 3 models, 1 snapshot, 4 data tests, 1 source, 575 macros
[0m06:42:57.739859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d58ff50>]}
[0m06:42:57.740556 [info ] [MainThread]: 
[0m06:42:57.740857 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:42:57.741271 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_KOALA'
[0m06:42:57.746986 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA"
[0m06:42:57.747155 [debug] [ThreadPool]: On list_USER_DB_KOALA: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA"} */
show terse schemas in database USER_DB_KOALA
    limit 10000
[0m06:42:57.747292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:42:58.221266 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.474 seconds
[0m06:42:58.222521 [debug] [ThreadPool]: On list_USER_DB_KOALA: Close
[0m06:42:58.348818 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA, now list_USER_DB_KOALA_SNAPSHOT)
[0m06:42:58.357281 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_SNAPSHOT"
[0m06:42:58.357656 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_SNAPSHOT"} */
show objects in USER_DB_KOALA.SNAPSHOT limit 10000
[0m06:42:58.357937 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:42:58.821308 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.463 seconds
[0m06:42:58.824857 [debug] [ThreadPool]: On list_USER_DB_KOALA_SNAPSHOT: Close
[0m06:42:59.191698 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_SNAPSHOT, now list_USER_DB_KOALA_analytics)
[0m06:42:59.193934 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_KOALA_analytics"
[0m06:42:59.194189 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "connection_name": "list_USER_DB_KOALA_analytics"} */
show objects in USER_DB_KOALA.analytics limit 10000
[0m06:42:59.194399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:42:59.583650 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.389 seconds
[0m06:42:59.585888 [debug] [ThreadPool]: On list_USER_DB_KOALA_analytics: Close
[0m06:42:59.711184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d6bb800>]}
[0m06:42:59.712512 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:42:59.713726 [info ] [MainThread]: 
[0m06:42:59.724778 [debug] [Thread-1 (]: Began running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:42:59.725563 [info ] [Thread-1 (]: 1 of 1 START snapshot SNAPSHOT.stock_price_snapshot ............................ [RUN]
[0m06:42:59.726383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_KOALA_analytics, now snapshot.azm_meta_stock_analytics.stock_price_snapshot)
[0m06:42:59.726725 [debug] [Thread-1 (]: Began compiling node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:42:59.740014 [debug] [Thread-1 (]: Began executing node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:42:59.770080 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:42:59.770338 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select OPEN, HIGH, LOW, CLOSE, VOLUME from (
                
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:42:59.770538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:43:00.866388 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.096 seconds
[0m06:43:00.873134 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:00.873592 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:43:00.961743 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.088 seconds
[0m06:43:00.969576 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:00.970006 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:43:01.051474 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.081 seconds
[0m06:43:01.085120 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:01.085577 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
create or replace temporary table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
         as
        (

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:43:01.991607 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.906 seconds
[0m06:43:01.993085 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:01.993273 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:43:02.081958 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.088 seconds
[0m06:43:02.083951 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:02.084166 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:43:02.183268 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.098 seconds
[0m06:43:02.186807 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:02.187451 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:43:02.321300 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.133 seconds
[0m06:43:02.323406 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:02.323623 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
[0m06:43:02.423530 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.100 seconds
[0m06:43:02.430182 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:02.430537 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
describe table "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp"
[0m06:43:02.533851 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.103 seconds
[0m06:43:02.553458 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:02.554041 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        

    with snapshot_query as (

        
  

  select
      md5(cast(coalesce(cast(SYMBOL as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(DATE as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as business_key,
      SYMBOL,
      DATE,
      OPEN,
      HIGH,
      LOW,
      CLOSE,
      VOLUME
  from USER_DB_KOALA.analytics.stg_stock_price


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        )))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m06:43:03.899854 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.345 seconds
[0m06:43:03.901595 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:03.901822 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
/* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m06:43:03.972539 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.070 seconds
[0m06:43:03.972965 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:03.974054 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:03.974277 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
BEGIN
[0m06:43:04.114535 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.140 seconds
[0m06:43:04.114855 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:04.115063 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
merge into "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT" as DBT_INTERNAL_DEST
    using "USER_DB_KOALA"."SNAPSHOT"."STOCK_PRICE_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("BUSINESS_KEY", "SYMBOL", "DATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:43:04.860145 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.745 seconds
[0m06:43:04.860549 [debug] [Thread-1 (]: Using snowflake connection "snapshot.azm_meta_stock_analytics.stock_price_snapshot"
[0m06:43:04.861415 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "azm_meta_stock_analytics", "target_name": "dev", "node_id": "snapshot.azm_meta_stock_analytics.stock_price_snapshot"} */
COMMIT
[0m06:43:05.170187 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.309 seconds
[0m06:43:05.179378 [debug] [Thread-1 (]: On snapshot.azm_meta_stock_analytics.stock_price_snapshot: Close
[0m06:43:05.292959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4c4ea0fb-e740-45f8-9ecb-e42ac12cf5bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff845b0f50>]}
[0m06:43:05.293586 [info ] [Thread-1 (]: 1 of 1 OK snapshotted SNAPSHOT.stock_price_snapshot ............................ [[32mSUCCESS 0[0m in 5.57s]
[0m06:43:05.293988 [debug] [Thread-1 (]: Finished running node snapshot.azm_meta_stock_analytics.stock_price_snapshot
[0m06:43:05.294831 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:43:05.295027 [debug] [MainThread]: Connection 'snapshot.azm_meta_stock_analytics.stock_price_snapshot' was properly closed.
[0m06:43:05.295218 [info ] [MainThread]: 
[0m06:43:05.295417 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 7.55 seconds (7.55s).
[0m06:43:05.295757 [debug] [MainThread]: Command end result
[0m06:43:05.313806 [info ] [MainThread]: 
[0m06:43:05.314124 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:43:05.314268 [info ] [MainThread]: 
[0m06:43:05.314564 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:43:05.315104 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.108266, "process_user_time": 2.427503, "process_kernel_time": 0.1166, "process_mem_max_rss": "212088", "process_out_blocks": "2448", "process_in_blocks": "0"}
[0m06:43:05.315344 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:43:05.315293 after 8.11 seconds
[0m06:43:05.315507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8460f260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83db1a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8407a000>]}
[0m06:43:05.315682 [debug] [MainThread]: Flushing usage events
